2026-02-16
Task complete: Contracts (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: added `TableConstraint.NullOrTrue(Name, Column)` as explicit model contract; kept deterministic naming/signature path with new `ConstraintIdentityKind.NullOrTrue`; DDL emits dialect-safe CHECK (`= TRUE` Pgsql, `= 1` Mssql).
Files changed: External RelationalModelTypes; ConstraintIdentity/Naming; ApplyConstraintDialectHashingPass; ApplyDialectIdentifierShorteningPass; RelationalModelOrdering; RelationalModelManifestEmitter; RelationalModelDdlEmitter; unit tests for manifest/ordering/shortening/DDL.
Blockers/notes: no blockers. Feedback loops green: DDL unit tests, RelationalModel unit tests, full dms solution build.
2026-02-16
Task complete: Key Unification (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: validated existing KeyUnificationPass behavior as matching acceptance: exact canonical SourceJsonPath endpoint resolution, fail-fast unresolved/ambiguous/unsupported endpoint kinds, deterministic applied/redundant/ignored(cross_table) diagnostics, per-table connected components, canonical+alias+presence gating, FK rewrite to canonical stored columns so no FK references UnifiedAlias/synthetic presence columns; no additional source changes needed.
Files changed: tasks.json; progress.txt.
Blockers/notes: no blockers. Feedback loops green: RelationalModel unit tests, full dms solution build.
2026-02-16
Task complete: Descriptor FKs (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: removed early descriptor FK constraint creation from `ReferenceBindingPass` + `ExtensionTableDerivationPass`; added post-key-unification `DescriptorForeignKeyConstraintPass` to map descriptor binding columns through `DbColumnModel.Storage`, emit one FK per `(table, storage_column)`, and capture deterministic descriptor FK de-dup diagnostics; FK names derive from `(table, storage_column)`.
Files changed: `DescriptorForeignKeyConstraintPass`; `RelationalModelSetPasses`; `RelationalModelTypes` + `RelationalModelCanonicalization`; `ReferenceBindingPass`; `ExtensionTableDerivationPass`; unit tests (`KeyUnificationPassTests`, `ReferenceBindingRelationalModelSetPassTests`, `ExtensionTableDerivationTests`, `RelationalModelSetPassesTests`); derived authoritative expected manifest.
Blockers/notes: no blockers. Feedback loops green: focused pass tests, full RelationalModel unit suite, and `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln` after refreshing expected derived golden output.
2026-02-16
Task complete: Reference Constraints (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: validated existing `ReferenceConstraintPass` behavior under unification as meeting acceptance: FK identity parts map via `UnifiedAliasStorageResolver`, repeated canonical storage columns de-dup after mapping with stable first-seen identity order, target `UX_*_RefKey` unique uses mapped/de-duped storage columns, all-or-none remains on per-site binding/path columns + `<Ref>_DocumentId`; no source edits required.
Files changed: `tasks.json`; `progress.txt`.
Blockers/notes: no blockers. Feedback loops green: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`, `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`.
2026-02-16
Task complete: Dialect Shortening (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: extended shortening rewrites to keep post-shortening model/manifest references consistent: `ColumnStorage.UnifiedAlias` canonical/presence pointers, `DbTableModel.KeyUnificationClasses`, and resource diagnostics (`KeyUnificationEqualityConstraints`, `DescriptorForeignKeyDeduplications`) all rewrite through dialect shortening.
Files changed: `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ApplyDialectIdentifierShorteningPass.cs`; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/DialectIdentifierShorteningTests.cs`; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/authoritative/ds-5.2/expected/authoritative-relational-model.derived.manifest.json`; `tasks.json`; `progress.txt`.
Blockers/notes: no blockers. Feedback loops green: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`; `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`. Refreshed derived authoritative expected manifest with `UPDATE_GOLDENS=1` for deterministic shortening updates.
2026-02-16
Task complete: Ordering (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: replaced simple column-name sort with dependency-aware topological ordering for `ColumnStorage.UnifiedAlias`; enforce canonical + presence-gate columns (`..._DocumentId` and synthetic `..._Present`) before dependent aliases; keep existing key/descriptor/scalar grouping as deterministic tie-break when no dependency conflict; retained deterministic constraint ordering by kind then name including `NullOrTrue`.
Files changed: `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Build/RelationalModelOrdering.cs`; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/CanonicalizeOrderingStepTests.cs`; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/authoritative/ds-5.2/expected/authoritative-relational-model.derived.manifest.json`; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/authoritative/sample/expected/authoritative-derived-relational-model-set.json`; `tasks.json`; `progress.txt`.
Blockers/notes: no blockers. Feedback loops green: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj` (after one-time `UPDATE_GOLDENS=1` refresh), `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`.
2026-02-16
Task complete: Manifests (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: emit `key_unification_equality_constraints` on every resource manifest with always-present arrays/object (`applied`/`redundant`/`ignored`/`ignored_by_reason`), map ignore reasons to stable wire token `cross_table`, preserve canonical endpoint ordering from diagnostics; emit per-table `descriptor_fk_deduplications` always present and derive `constraint_name` from actual emitted descriptor FK (`dms.Descriptor(DocumentId)`) for final post-shortening/hash correctness.
Files changed: `RelationalModelManifestEmitter`; `RelationalModelManifestEmitterTests`; authoritative expected manifests (`authoritative-relational-model.manifest.json`, `authoritative-relational-model.derived.manifest.json`); `tasks.json`; `progress.txt`.
Blockers/notes: no blockers. Feedback loops green: targeted manifest emitter tests, full RelationalModel unit suite, `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`; refreshed authoritative expected manifests with `UPDATE_GOLDENS=1` for new manifest fields.
2026-02-16
Task complete: Goldens (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: switched `RelationalModelAuthoritativeGoldenTests` from per-resource builder pipeline to set-level `DerivedRelationalModelSetBuilder` (+ endpoint/resource mapping + extension-site capture) so reference binding/key unification/descriptor FK de-dup run in authoritative manifest path; expanded derived-set `resource_details` coverage to include `Ed-Fi.ProgramEvaluationElement` + `Ed-Fi.StudentAssessmentRegistration`; refreshed affected expected goldens once with `UPDATE_GOLDENS=1`; no `RelationalMappingVersion` bump.
Files changed: `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/RelationalModelAuthoritativeGoldenTests.cs`; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/DerivedRelationalModelSetAuthoritativeGoldenTests.cs`; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/authoritative/ds-5.2/expected/authoritative-relational-model.manifest.json`; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/authoritative/sample/expected/authoritative-derived-relational-model-set.json`; `tasks.json`; `progress.txt`.
Blockers/notes: no blockers. Feedback loops green: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj` (with one-time `UPDATE_GOLDENS=1` refresh then clean run), `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`.
2026-02-17
Task complete: Docs (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: updated mapping-pack v1 contract doc to include `TableConstraint.AllOrNoneNullability`, `TableConstraint.NullOrTrue`, and FK referential actions (`on_delete`, `on_update`) in protobuf shape; aligned deterministic constraint ordering text to kind-group then name; added non-normative note that this repo does not bump `RelationalMappingVersion` in this change.
Files changed: `reference/design/backend-redesign/design-docs/mpack-format-v1.md`; `tasks.json`; `progress.txt`.
Blockers/notes: no blockers. Feedback loops green: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`, `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`.
2026-02-17
Task complete: Contracts (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: moved `DbColumnModel.Storage` into primary record ctor so equality/deconstruct/with include storage by contract; retained 6-arg compatibility ctor defaulting to `new ColumnStorage.Stored()` to avoid call-site churn and preserve existing semantics.
Files changed: `src/dms/backend/EdFi.DataManagementService.Backend.External/RelationalModelTypes.cs`; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/DbColumnModelStorageContractTests.cs`; `tasks.json`; `progress.txt`.
Blockers/notes: no blockers. Feedback loops green: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`; `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.Ddl.Tests.Unit/EdFi.DataManagementService.Backend.Ddl.Tests.Unit.csproj`; `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`.
2026-02-17
Task complete: Key Unification (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: removed FK mutation (`RewriteForeignKeyColumnsToStorage`) from `KeyUnificationPass` so unification only changes storage metadata + presence hardening; rely on `ValidateForeignKeyStorageInvariantPass` as fail-fast contract for FK endpoints (no UnifiedAlias/synthetic presence); added explicit local-alias invariant test for actionable diagnostics.
Files changed: `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs`; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/KeyUnificationPassTests.cs`; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ConstraintDerivationRelationalModelSetPassTests.cs`; `tasks.json`; `progress.txt`.
Blockers/notes: no blockers. Feedback loops green: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`; `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`.
2026-02-17
Task complete: Refactoring (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: extracted shared `ForeignKeyStorageValidator` and removed duplicated FK-column validation from `DeriveIndexInventoryPass`; both `ValidateForeignKeyStorageInvariantPass` and index derivation now use one endpoint validator for deterministic local/target checks against `UnifiedAlias` and synthetic presence columns; retained explicit dms.Document target-column validation in shared path.
Files changed: `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ForeignKeyStorageValidator.cs`; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ValidateForeignKeyStorageInvariantPass.cs`; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/DeriveIndexInventoryPass.cs`; `tasks.json`; `progress.txt`.
Blockers/notes: no blockers. Feedback loops green: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`; `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`.
2026-02-17
Task complete: Key Unification (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: simplified `ResolveCanonicalBaseName` to spec behavior by deriving canonical base token from first ordered member only; removed dead branch and member-token array allocation.
Files changed: `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs`; `tasks.json`; `progress.txt`.
Blockers/notes: no blockers. Feedback loops green: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`; `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln` (build had one transient copy-retry warning, no errors).
2026-02-17
Task complete: Key Unification (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: replaced component ordering key `string.Join("|", ...)` + redundant per-component `OrderBy` with deterministic list comparer (first member, then length, then ordinal sequence) to preserve stable ordering while removing extra sorts/string allocations.
Files changed: `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs`; `tasks.json`; `progress.txt`.
Blockers/notes: no blockers. Feedback loops green: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`; `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`.
2026-02-17
Task complete: Dialect Shortening (`reference/design/backend-redesign/epics/01-relational-model/07-index-and-trigger-inventory.md`), prep for `reference/design/backend-redesign/design-docs/key-unification.md`.
Decisions: simplified `ColumnStorage.UnifiedAlias` change detection to equivalent auditable expression using `Nullable.Equals` for presence gate; kept canonical-column comparison unchanged; behavior preserved.
Files changed: `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ApplyDialectIdentifierShorteningPass.cs`; `tasks.json`; `progress.txt`.
Blockers/notes: no blockers. Feedback loops green: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`; `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`.
