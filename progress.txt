- Task: Docs (DMS-930 story 01-reference-and-constraints.md)
  Decisions: Added "Handoff from DMS-930" section documenting provisional naming helpers/passes, reference-only nameOverrides, and collision detection without rewriting; listed DMS-931 responsibilities for full naming/overrides/shortening.
  Files: reference/design/backend-redesign/epics/01-relational-model/02-naming-and-overrides.md; tasks.json; progress.txt
  Notes: dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with pre-existing SyntheticTests feature warning.
- Task: Split constraint derivation pass (story 01-reference-and-constraints.md)
  Decisions: Split into RootIdentityConstraintRelationalModelSetPass, ReferenceConstraintRelationalModelSetPass, ArrayUniquenessConstraintRelationalModelSetPass; added ConstraintDerivationHelpers for shared constraint helpers + ResourceMutation; introduced ReferenceConstraintContext to cut ApplyReferenceConstraintsForResource params.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ConstraintDerivationHelpers.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RootIdentityConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ArrayUniquenessConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalModelSetPasses.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ConstraintDerivationRelationalModelSetPass.cs (deleted); src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ConstraintDerivationRelationalModelSetPassTests.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/RelationalModelSetPassesTests.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests feature warning.
- Task: Share cached ExtractInputsStep output (DMS-930 story 01-reference-and-constraints.md)
  Decisions: Added shared RelationalModelSetBuilderContext cache for per-resource builder contexts with precomputed descriptor paths; passes now pull builder contexts from set-level cache; removed redundant BuildResourceContext/GetOrCreateBuilderContext helpers.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalModelSetBuilderContext.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RootIdentityConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceBindingRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ArrayUniquenessConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalModelSetSchemaHelpers.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests feature warning.
- Task: Array uniqueness failure aggregation (DMS-930 story 01-reference-and-constraints.md)
  Decisions: Collect all candidate failures and combine into a single InvalidOperationException with AggregateException inner; preserve original-scope failure unless aligned scope succeeds; added custom-pass fixture to surface both candidate messages.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ArrayUniquenessConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ConstraintDerivationRelationalModelSetPassTests.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests warning.
- Task: Deterministic SourceJsonPath column lookup (DMS-930 story 01-reference-and-constraints.md)
  Decisions: Added BuildColumnNameLookupBySourceJsonPath ordering by column name to avoid nondeterminism; root and reference identity derivation now uses helper; added test for duplicate SourceJsonPath selecting lexicographically first column.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ConstraintDerivationHelpers.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RootIdentityConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ConstraintDerivationRelationalModelSetPassTests.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests feature warning.
- Task: Shared base-resource resolution helper (DMS-930 story 01-reference-and-constraints.md)
  Decisions: Added ResolveBaseResourceForExtension helper in RelationalModelSetSchemaHelpers and replaced per-pass extension/base lookup error logic (reference binding/constraints/array uniqueness/extension table) to keep diagnostics consistent.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalModelSetSchemaHelpers.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceBindingRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ArrayUniquenessConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ExtensionTableDerivationRelationalModelSetPass.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests warning.
- Task: Deterministic array uniqueness scope order (DMS-930 story 01-reference-and-constraints.md)
  Decisions: Iterate pathsByScope ordered by canonical scope StringComparer.Ordinal to remove dictionary order nondeterminism; no behavior change besides deterministic traversal.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ArrayUniquenessConstraintRelationalModelSetPass.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests warning.
- Task: Pass order doc reconciliation (DMS-930 story 01-reference-and-constraints.md)
  Decisions: Updated DMS-1033 pass ordering list to match current RelationalModelSetPasses order; noted abstract identity tables must precede reference constraints for abstract FK targets.
  Files: reference/design/backend-redesign/epics/01-relational-model/08-derived-relational-model-set-builder.md; tasks.json; progress.txt
  Notes: dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests feature warning.
- Task: Mixed-kind SourceJsonPath collision guard (DMS-930 story 01-reference-and-constraints.md)
  Decisions: BuildColumnNameLookupBySourceJsonPath now throws when a source path maps to columns with different ColumnKind; same-kind duplicates still resolve deterministically by column name.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ConstraintDerivationHelpers.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RootIdentityConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ConstraintDerivationRelationalModelSetPassTests.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests warning.
- Task: Reduce duplicate schema-input extraction work (DMS-930 story 01-reference-and-constraints.md)
  Decisions: Cache per-resource builder contexts from base traversal so set-level passes reuse ExtractInputsStep output; injectable ExtractInputsStep used for counting test; test asserts ExtractInputsStep runs once per resource across default passes.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalModelSetBuilderContext.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/BaseTraversalAndDescriptorBindingRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ExtractInputsStepCachingTests.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests warning.
- Task: Set-level canonical ordering pass (DMS-930 story 01-reference-and-constraints.md)
  Decisions: Extracted RelationalModelCanonicalization helper for shared ordering logic; added CanonicalizeOrderingRelationalModelSetPass to re-apply canonical table/document reference/descriptor edge ordering after set-level passes; updated default pass order and golden fixture for canonical ordering; added out-of-order documentPathsMapping test for reference bindings + descriptor edges.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/CanonicalizeOrderingStep.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalModelCanonicalization.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/CanonicalizeOrderingRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalModelSetPasses.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/CanonicalizeOrderingRelationalModelSetPassTests.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/RelationalModelSetPassesTests.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/authoritative/sample/expected/authoritative-derived-relational-model-set.json; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed (ran once with UPDATE_GOLDENS=1 to refresh goldens). dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests feature warning.
- Task: EnsureTargetUnique cross-resource mutation coverage (DMS-930 story 01-reference-and-constraints.md)
  Decisions: Added target-unique mutation tests for single/multiple references; asserted target has no reference bindings but gains unique constraint; documented cross-resource mutation side-effect in EnsureTargetUnique.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ConstraintDerivationRelationalModelSetPassTests.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests warning.
- Task: Document implicit contracts (DMS-930 story 01-reference-and-constraints.md)
  Decisions: Documented required identity references and array uniqueness reference identity path binding to DocumentId; noted enforcement points and rationale.
  Files: reference/design/backend-redesign/epics/01-relational-model/01-reference-and-constraints.md; tasks.json; progress.txt
  Notes: Docs-only change; no build/test run.
- Task: Validate reference identity completeness in array uniqueness constraints (DMS-930 story 01-reference-and-constraints.md)
  Decisions: Added ExtractInputsStep validation to require full reference identity path coverage per array uniqueness scope (including extension-aligned paths) and include reference object path in identity mapping errors; added tests for partial array uniqueness paths and nested constraint cases.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ExtractInputsStep.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/SchemaInputValidationTests.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests warning.
- Task: Maintainability (order-independent reference identity binding) (story 01-reference-and-constraints.md)
  Decisions: Map reference identity bindings by derived column names (reference base from FK + identity path base) instead of list index; validate referenceJsonPath counts for missing/extra bindings; moved BuildIdentityPartBaseName to RelationalModelSetSchemaHelpers; added shuffled binding order test.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalModelSetSchemaHelpers.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceBindingRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ConstraintDerivationRelationalModelSetPassTests.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests warning.
- Task: Decouple isPartOfIdentity validation (DMS-930 story 01-reference-and-constraints.md)
  Decisions: ExtractInputsStep now derives identity membership solely from identityJsonPaths; removed isPartOfIdentity mismatch validation/helper; requiredness/partial-reference diagnostics reference identityJsonPaths; schema-input validation fixtures updated to allow mismatches and added descriptor target metadata for success cases.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ExtractInputsStep.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/SchemaInputValidationTests.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests warning.
- Task: Tests (DMS-930 story 01-reference-and-constraints.md)
  Decisions: SchemaInputValidationTests assert DocumentReferenceMappings identity classification derives from identityJsonPaths (ignores isPartOfIdentity); identity-reference requiredness guard test now uses isPartOfIdentity=false to prove identityJsonPaths drives requirement.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/SchemaInputValidationTests.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests warning.
- Task: Docs identityJsonPaths authority (DMS-930 story 01-reference-and-constraints.md)
  Decisions: Documented identityJsonPaths as sole authority for natural-key membership; clarified isPartOfIdentity is a superset not cross-validated and does not drive relational identity derivation; referenced ExtractInputsStep enforcement.
  Files: reference/design/backend-redesign/epics/01-relational-model/01-reference-and-constraints.md; tasks.json; progress.txt
  Notes: Docs-only change; no build/test run.
- Task: Constraint identity refactor (DMS-931 story 02-naming-and-overrides.md)
  Decisions: Added internal ConstraintIdentity signature (kind/table/columns/targets/actions) so dedupe checks no longer depend on physical names; updated constraint passes to compare semantic identity; added tests proving renamed constraints still match and actions differentiate.
  Files: src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ConstraintIdentity.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ConstraintDerivationHelpers.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RootIdentityConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ArrayUniquenessConstraintRelationalModelSetPass.cs; src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ConstraintIdentityTests.cs; tasks.json; progress.txt
  Notes: dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj passed; dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln succeeded with existing SyntheticTests feature warning.
