2026-02-13
- Completed: tasks.json#0 Algorithm subsection under "Integration Point + Pass Ordering" (DMS-1033)
- Decisions: single ordered list; explicitly lists fail-fast + pass mutations (Columns/Constraints/KeyUnificationClasses/eq-constraint diagnostics); inlines canonical+presence naming + hash formulas; explicit non-goals (no FK rewrite; FK derivation later in ReferenceConstraintPass)
- Files: reference/design/backend-redesign/design-docs/key-unification.md; tasks.json; progress.txt
- Notes: follow-up tasks likely: #4 FK responsibility/allowIdentityUpdates/ON DELETE wording; #3 make ref-membership detection rule normative for presence gating (SourceJsonPath lookup vs current "identity binding" wording)
- Completed: tasks.json#3 Presence Gating (design doc)
- Decisions: presence gating uses authoritative lookup (member SourceJsonPath == DocumentReferenceBinding.IdentityBindings[*].ReferenceJsonPath); gate by binding FkColumn when found; non-reference optional uses synthetic ..._Present; non-reference required is ungated; fail fast on ambiguous multiple bindings; avoid name parsing heuristics
- Files: reference/design/backend-redesign/design-docs/key-unification.md; tasks.json; progress.txt
- Completed: tasks.json#2 Schema Exceptions (DMS-1033)
- Decisions: ApiSchema `equalityConstraints` authoritative; legacy ODS physical-schema differences are non-authoritative; no v1 suppression/override; canonical always new column + members become `UnifiedAlias` (presence-gated when optional)
- Files: reference/design/backend-redesign/design-docs/key-unification.md; tasks.json; progress.txt
- Notes: if an equality constraint appears incorrect, fix upstream (ApiSchema generation / effective schema inputs); diagnostics remain `applied`/`redundant`/`ignored`
- Completed: tasks.json#9 Defaults (design doc)
- Decisions: ColumnStorage init default = `Stored` for all pre-existing columns; KeyUnificationPass only pass that sets `UnifiedAlias`; canonical + synthetic presence columns always `Stored`; old artifacts missing storage metadata rejected via `RelationalMappingVersion` mismatch (back-compat only via explicit older-version mode)
- Files: reference/design/backend-redesign/design-docs/key-unification.md; tasks.json; progress.txt
- Completed: tasks.json#4 Foreign Keys (DMS-1033)
- Decisions: KeyUnificationPass mutates columns/classes only (no FK emission); ReferenceConstraintPass emits composite ref FKs by mapping bindingâ†’storage via `DbColumnModel.Storage`; referential actions unchanged (ON UPDATE allowIdentityUpdates-gated + existing SQL Server fallback; ON DELETE NO ACTION)
- Files: reference/design/backend-redesign/design-docs/key-unification.md; tasks.json; progress.txt
- Completed: tasks.json#1 Dialect Hashing (DMS-1033)
- Decisions: NullOrTrue constraint signature = (kind="NullOrTrue", table=(schema,name), column=PresenceColumnName); explicitly participates in ApplyConstraintDialectHashingPass + ApplyDialectIdentifierShorteningPass; shortening updates Name + Column references
- Files: reference/design/backend-redesign/design-docs/key-unification.md; tasks.json; progress.txt
