[
  {
    "category": "Passes",
    "description": "Implement the initial set-level **Base traversal pass** (DMS-929 integration) as an `IRelationalModelSetPass` that loops all concrete, non-extension resources across all projects in canonical order and runs the existing per-resource `RelationalModelBuilderPipeline` (using the set-level precomputed descriptor-path map). Ensure the pass uses a descriptor-path map filtered/partitioned appropriately so base traversal does not fail on descriptor paths that exist only under `_ext` (see `reference/design/backend-redesign/epics/01-relational-model/03-ext-mapping.md`). Aggregate per-resource outputs into `ConcreteResourcesInNameOrder` as `ConcreteResourceModel` entries and track discovered `_ext` sites (and any extension-scoped descriptor-path partitions) for later passes. Acceptance: all eligible resources contribute a `ConcreteResourceModel`, ordering is stable, and `_ext` sites are discovered deterministically without false fail-fast errors from extension-only descriptor paths.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Validation",
    "description": "Implement `_ext` project-key resolution and fail-fast behavior during set-level derivation: when `_ext` project keys are discovered, resolve each key to a configured project (first match on `ProjectEndpointName` case-insensitive, then fallback match on `ProjectName` case-insensitive). Fail fast when the key is unknown or when the key matches multiple projects case-insensitively (ambiguity). Acceptance: unit tests cover unknown `_ext` key and ambiguous `_ext` key failures with actionable error messages.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Tests",
    "description": "Add set-level builder unit tests and fixtures for DMS-1033 in `EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit`: (1) a small hand-authored multi-project fixture (core + extension) exercising cross-project descriptor propagation, target validation, `_ext` key validation, physical schema collision validation, and any `_ext`-scoped descriptor-path partition behavior needed to avoid false fail-fast errors during base traversal; (2) a golden real-schema fixture that exercises a \"core + extension\" effective schema set using authoritative inputs. If `sample-api-schema-authoritative.json` is not available in-repo, either (A) add it under `Fixtures/authoritative/sample/inputs/` from an authoritative source, or (B) replace this step with a checked-in minimal authoritative extension fixture so tests are not blocked on a missing file. Acceptance: tests cover determinism across input ordering, unknown `_ext` key failure, ambiguous `_ext` key failure, physical schema name collision failure, missing documentPathsMapping target failure, and `EffectiveSchemaInfo` resource-key mismatch failures.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Tests",
    "description": "Add unit tests for deterministic pass ordering/execution in `DerivedRelationalModelSetBuilder`: provide an intentionally unsorted pass list and assert execution order is sorted by `(Order asc, pass type full name ordinal)`. Also assert duplicate ordering keys (same `Order` + same pass type) throw a clear error. Acceptance: tests prove stable ordering independent of registration/list order and prevent silent duplicate pass registration.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Tests",
    "description": "Add unit tests for identifier shortening in `PgsqlDialectRules` and `MssqlDialectRules`: (1) identifiers at/below the dialect limit are unchanged; (2) over-limit identifiers are shortened deterministically (same input -> same output) and produce results within the limit; (3) PostgreSQL shortening measures UTF-8 byte length (include a multibyte input case) while SQL Server uses character count. Acceptance: tests validate length enforcement and multibyte handling without requiring any database or SQL emission.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Builder",
    "description": "Prevent pass-registration drift by providing a single canonical default pass list for `DerivedRelationalModelSetBuilder`. Add a factory (e.g., `RelationalModelSetPasses.CreateDefault()`) that returns the ordered pass list used by runtime compilation and DDL emission, and ensure all production call sites use it. Acceptance: there is exactly one default pass-list definition in the codebase; a unit test asserts the default list order begins with base traversal and is stable; all existing unit tests remain green.",
    "steps-to-verify": [
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Derivation",
    "description": "Pragmatic DMS-929/DMS-930 alignment: keep current behavior where the base traversal pipeline binds descriptor paths to `*_DescriptorId` columns (and emits descriptor-edge metadata), but clarify responsibilities to prevent future drift. (1) Rename `DeriveColumnsAndBindDescriptorEdgesStep` to reflect it performs descriptor binding (not just base traversal), and rename `BaseTraversalAndDescriptorBindingRelationalModelSetPass` if needed to avoid implying it is scalars-only. (2) Update epic docs so DMS-929 vs DMS-930 responsibilities match what is implemented (base tables/scalars vs descriptor binding vs reference binding/constraints): update `reference/design/backend-redesign/epics/01-relational-model/00-base-schema-traversal.md` and `reference/design/backend-redesign/epics/01-relational-model/01-reference-and-constraints.md`. Acceptance: no functional behavior change; `dotnet build` and relational-model unit tests remain green; doc wording clearly states descriptor binding happens in the base traversal pass while document-reference binding/constraints remain in DMS-930.",
    "steps-to-verify": [
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Validation",
    "description": "Enforce that `_ext` project keys resolve to extension projects only. When resolving `_ext` keys, fail fast if the resolved project has `IsExtensionProject == false`, since `_ext` tables must live in an extension project schema. Acceptance: resolving an `_ext` key that matches a non-extension project throws an `InvalidOperationException` including the key, the owning resource, and the resolved project endpoint/name; add a unit test that configures a matching non-extension project and asserts the failure.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Determinism",
    "description": "Tighten set-level pass ordering rules to avoid refactor-driven behavior changes. Today `DerivedRelationalModelSetBuilder` allows multiple passes to share the same `IRelationalModelSetPass.Order` and breaks ties by `pass.GetType().FullName`, which is deterministic but brittle under renames/namespace moves. Change the ordering contract so pass sequencing is fully intentional: (1) fail fast when two different passes share the same `Order` value (require unique order numbers), and (2) stop using type name as an implicit tie-breaker for execution order. Update unit tests to reflect the new contract (e.g., `Given_An_Unordered_Pass_List` should still be ordered by numeric order; a new test should assert duplicate order values fail fast). Update XML docs on `IRelationalModelSetPass.Order` to state uniqueness is required and ordering must not depend on type names. Acceptance: duplicate order values throw an actionable `InvalidOperationException`; ordering behavior remains stable across refactors; `dotnet build` and relational-model unit tests remain green after updates.",
    "steps-to-verify": [
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Refactor",
    "description": "Reduce `RelationalModelSetBuilderContext` complexity by extracting internal collaborators (without changing public behavior):\n- `ProjectSchemaNormalizer` (project list normalization + physical schema collision detection)\n- `DescriptorPathMapBuilder` (descriptor path inference across projects + `_ext` partitioning)\n- `IdentifierCollisionDetector` (dialect-shortening collision detection)\n\nAcceptance:\n- Public API and behavior of `RelationalModelSetBuilderContext` remain unchanged.\n- `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalModelSetBuilderContext.cs` shrinks by at least 30% (line count) and no longer contains multiple unrelated responsibilities.\n- Determinism tests continue to pass (no changes in emitted manifests for existing fixtures).",
    "steps-to-verify": [
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Determinism",
    "description": "Remove ambiguity around mutable lists named `*InNameOrder` on `RelationalModelSetBuilderContext` that are only canonicalized during `BuildResult()`.\n\nRename the mutable lists to neutral names (`ConcreteResources`, `AbstractIdentityTables`, etc.) and add read-only canonical views/enumerators (e.g., `EnumerateConcreteResourcesInNameOrder()`).\n\nAcceptance:\n- All tests pass after the rename.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Docs/Contracts",
    "description": "Clarify that `DerivedRelationalModelSet.IndexesInCreateOrder` / `TriggersInCreateOrder` are stored in canonical deterministic order (schema, table, name), not a dependency-aware DDL execution order.\n\nAcceptance:\n- Update XML docs in `src/dms/backend/EdFi.DataManagementService.Backend.External/DerivedRelationalModelSetContracts.cs` to state canonical ordering explicitly and to warn consumers not to assume dependency ordering.\n- Update `reference/design/backend-redesign/design-docs/compiled-mapping-set.md` to use consistent terminology (e.g., \"canonical deterministic order\") and avoid implying execution-order semantics.\n- No behavior changes; unit tests remain green.",
    "steps-to-verify": [
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Contracts",
    "description": "Document and enforce the shared-storage invariant: `RelationalResourceModel.PhysicalSchema` represents the owning project schema and may differ from `Root.Table.Schema` for shared-storage resources (e.g., descriptors stored in `dms.Descriptor`).\n\nAcceptance:\n- Add XML doc notes on `RelationalResourceModel.PhysicalSchema` (in `src/dms/backend/EdFi.DataManagementService.Backend.External/RelationalModelTypes.cs`) explaining that consumers must use each `DbTableModel.Table.Schema` when emitting table DDL.\n- Add a unit test that builds a descriptor resource model and asserts:\n  - `model.StorageKind == SharedDescriptorTable`\n  - `model.PhysicalSchema != model.Root.Table.Schema` (project schema vs `dms`)\n  - the descriptor root table is `dms.Descriptor`\n- No functional change to derivation logic; unit tests remain green.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": false
  },
  {
    "category": "Refactor/DRY",
    "description": "Deduplicate resource schema ordering logic to prevent drift. Today `OrderResourceSchemas(...)` exists in both `DescriptorPathInference` and `RelationalModelSetValidation`.\n\nAcceptance:\n- Move the shared ordering helper into `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalModelSetSchemaHelpers.cs` (or another single internal helper location).\n- Both `DescriptorPathInference` and `RelationalModelSetValidation` use the shared helper.\n- Ordering behavior remains identical (determinism tests unchanged); unit tests remain green.",
    "steps-to-verify": [
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": false
  }
]
