[
  {
    "category": "Naming",
    "description": "DMS-931: Apply dialect identifier shortening into the derived model (not just collision detection), including schema names. Today `RelationalModelSetBuilderContext.BuildResult` detects shortening collisions, but the model still stores pre-shortened identifiers, forcing every downstream consumer to remember to shorten consistently. Acceptance: (1) A set-level pass rewrites *all* derived identifiers using `context.DialectRules.ShortenIdentifier` and stores the shortened names in the `DerivedRelationalModelSet` (schemas, tables, columns, constraints, indexes, triggers, abstract identity tables/views); (2) all internal references are updated consistently (FK `TargetTable/TargetColumns`, `DocumentReferenceBinding.Table/FkColumn/IdentityBindings`, `DescriptorEdgeSource`, index/trigger `Table/KeyColumns`, etc.); (3) the pass is deterministic and idempotent (running twice yields the same model); (4) collision detection still fails fast when multiple original identifiers shorten to the same value, using the structured collision record format; (5) unit tests cover overlong table/column/constraint/index/trigger/schema names and assert the shortened identifiers are present in the output and referenced correctly; (6) all unit tests pass and the DMS solution builds.",
    "steps-to-verify": [
      "Implement a new set-level pass (e.g., `ApplyDialectIdentifierShorteningRelationalModelSetPass`) that rewrites identifiers in-place on `RelationalModelSetBuilderContext` inventories using `DialectRules.ShortenIdentifier` and updates all references consistently (including `ProjectSchemasInEndpointOrder[*].PhysicalSchema`).",
      "Register the pass in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalModelSetPasses.cs` after the DMS-931 naming/override/constraint-naming pass and before `CanonicalizeOrderingRelationalModelSetPass`.",
      "Add unit tests that force overlong identifiers (including schema names) and assert the shortened names are stored in the resulting `DerivedRelationalModelSet` and referenced correctly by constraints/bindings/inventories. Include at least one Pgsql (63-byte) and one Mssql (128-char) case.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Testing",
    "description": "DMS-931: Add “naming-stress” hand-authored fixtures + extend authoritative expected outputs (inputs unchanged). Acceptance: (1) New unit tests are built from `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/set-builder/*` fixtures and exercise: long names, `rootTableNameOverride`, scalar/reference/array overrides (including nested-array remainder ordinal naming, inside-reference identity overrides, and nested collection override compatibility without descendant/prefix requirements), extension-schema override auto-prefixing, reserved-word/edge-case normalization, and collision diagnostics; (2) authoritative fixture inputs remain unchanged; only `expected/` outputs are updated to reflect new naming/override/constraint-naming/shortening behavior; (3) the authoritative derived model set JSON comparisons pass; (4) the DMS solution builds.",
    "steps-to-verify": [
      "Add/extend hand-authored fixture inputs under `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/set-builder/` to cover naming stress scenarios without requiring changes to authoritative inputs.",
      "Update authoritative `expected/authoritative-derived-relational-model-set.json` files to match the new deterministic naming + constraint naming + shortening behavior.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Design",
    "description": "DMS-931: Update backend-redesign override design docs to match authoritative goldens (inside-reference identity overrides allowed; relaxed collection override rules). Acceptance: (1) `reference/design/backend-redesign/design-docs/flattening-reconstitution.md` no longer states that identity paths inside reference objects are invalid; it distinguishes reference-object overrides vs reference-identity overrides and constrains inside-reference overrides to reference identity JSONPaths; (2) the doc removes any requirement that nested collection override values start with the parent suffix or that descendant collection overrides are required; (3) the doc states collection override values are interpreted as the collection segment/base name and allows fully-qualified values via deterministic stripping of already-implied root/ancestor prefixes; (4) examples include at least one inside-reference identity override and one ancestor-only collection override.",
    "steps-to-verify": [
      "Update `reference/design/backend-redesign/design-docs/flattening-reconstitution.md` sections 3.2/3.3 to reflect the updated rules (reference-object override vs reference-identity override; relaxed collection rules; prefix-stripping compatibility) and add/adjust examples accordingly.",
      "Confirm `reference/design/backend-redesign/design-docs/flattening-reconstitution.md` language matches the updated DMS-931 acceptance text in `tasks.json` (no contradictions)."
    ],
    "completed": true
  },
  {
    "category": "Backend",
    "description": "DMS-931: Allow inside-reference identity overrides during input validation (reject non-identity inside-reference keys). Acceptance: (1) `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ExtractInputsStep.cs` allows an override key inside a reference object only if it exactly matches one of the mapping’s `ReferenceJsonPaths[*].ReferenceJsonPath` canonicals; (2) authoritative overrides like `$.graduationSchoolYearTypeReference.schoolYear` are accepted; (3) non-identity inside-reference keys (e.g., `$.schoolReference.link`) still fail fast with diagnostics that include raw key text + canonical form.",
    "steps-to-verify": [
      "Update inside-reference validation in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ExtractInputsStep.cs` (near the existing inside-reference failure) to allow only reference identity JSONPaths from the mapping and to fail fast on other inside-reference keys.",
      "Update/add unit tests in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/SchemaInputValidationTests.cs` to cover allowed inside-reference identity override and rejected non-identity inside-reference key.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Backend",
    "description": "DMS-931: Apply inside-reference identity overrides to propagated reference identity column base names. Acceptance: (1) `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceBindingRelationalModelSetPass.cs` consults `nameOverrides` for each `identityBinding.ReferenceJsonPath` and applies the override value to the propagated identity column base name when present; (2) any binding metadata that depends on the identity column base name is updated consistently so downstream lookups/reconstitution use the overridden names; (3) if both a reference-object override and an inside-reference identity override are present, the identity override wins for the specific identity column while the reference-object override still applies to the reference bundle artifacts (FK `..._DocumentId`, etc.).",
    "steps-to-verify": [
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceBindingRelationalModelSetPass.cs` to consult `TryGetNameOverride(identityBinding.ReferenceJsonPath, Column)` (or equivalent) when creating propagated identity columns and apply the override to the identity column base name.",
      "Add/adjust unit tests to assert a reference identity column can be renamed via an inside-reference identity override without renaming non-identity keys inside the reference.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Backend",
    "description": "DMS-931: Relax collection override derivation (no descendant override requirement; no parent-prefix requirement) and add prefix-stripping compatibility. Acceptance: (1) `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/DeriveTableScopesAndKeysStep.cs` and `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ExtensionTableDerivationRelationalModelSetPass.cs` no longer throw when an ancestor collection override exists without descendant overrides; (2) nested collection override values do not need to start with the parent suffix; (3) collection override values are resolved to an effective segment by deterministically stripping already-implied root/ancestor prefixes when present, so segment-only and fully-qualified values produce the same derived names; (4) authoritative fixture shapes like `CommunityOrganization` with only `$.indicators[*]` override build successfully.",
    "steps-to-verify": [
      "Remove the \"descendant override required\" checks from `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/DeriveTableScopesAndKeysStep.cs` and `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ExtensionTableDerivationRelationalModelSetPass.cs`.",
      "Replace the strict `StartsWith(parentSuffix)` logic in both files with a compatibility resolver that computes the effective segment/base name and deterministically strips implied root/ancestor prefixes when present (no hard requirement).",
      "Update/add unit tests in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/NameOverrideTests.cs` to cover missing descendant overrides and nested overrides without parent-prefix requirements.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Testing",
    "description": "DMS-931: Update schema input validation tests for inside-reference identity overrides. Acceptance: (1) `SchemaInputValidationTests` accepts an inside-reference override whose key matches a reference identity JSONPath from the mapping; (2) it rejects a non-identity inside-reference key such as `$.schoolReference.link`.",
    "steps-to-verify": [
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/SchemaInputValidationTests.cs` to add/adjust tests around the existing inside-reference validation coverage.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Testing",
    "description": "DMS-931: Update override derivation tests to allow missing descendant collection overrides. Acceptance: (1) The previous \"missing descendant override\" fixture no longer throws; (2) tests assert the expected derived table scope names/keys when an ancestor collection override exists without a descendant override.",
    "steps-to-verify": [
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/NameOverrideTests.cs` (near the existing descendant override test) to assert successful build + expected naming behavior instead of asserting an exception.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Testing",
    "description": "DMS-931: Add a focused unit test proving nested collection overrides work without the parent-prefix form (and that fully-qualified values are compatible). Acceptance: (1) A nested collection override value that does not start with the parent suffix is accepted; (2) a fully-qualified nested override value that includes implied prefixes yields the same effective derived names as the segment-only form.",
    "steps-to-verify": [
      "Add a new unit test (and any minimal fixture) under `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/` covering nested collection override segment resolution and prefix-stripping compatibility.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Verification",
    "description": "DMS-931: Verify override alignment changes against authoritative goldens. Acceptance: (1) `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj` passes; (2) `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln` succeeds; (3) no authoritative input fixtures were modified (only code/docs/expected outputs as needed).",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`",
      "Confirm no changes under `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/authoritative/*/inputs/`."
    ],
    "completed": true
  },
  {
    "category": "Validation",
    "description": "DMS-931 follow-up: Close collision detection gaps for direct duplicate identifiers by updating `OverrideCollisionDetector` and `IdentifierCollisionDetector` to collide on multiple distinct origins, not only multiple distinct original identifier strings. Acceptance: (1) Build fails when two distinct derived elements share the same final identifier in a collision scope even when their original identifier strings are identical (e.g., root table name collisions created by `rootTableNameOverride`); (2) de-duplication only suppresses truly duplicate registrations of the same element (same origin), not distinct derived elements; (3) diagnostics remain deterministic and include the collision stage, scope, and origin details (resource label + JSONPath) for each conflicting source; (4) existing collision tests remain passing.",
    "steps-to-verify": [
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/OverrideCollisionDetector.cs` to treat multiple unique origins for the same final identifier as a collision even when `OriginalIdentifier` matches.",
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/IdentifierCollisionDetector.cs` to treat multiple unique origins for the same shortened identifier as a collision even when `OriginalIdentifier` matches.",
      "Ensure collision-source ordering remains deterministic (Ordinal) and stage labels remain accurate (`AfterOverrideNormalization`, `AfterDialectShortening`).",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Testing",
    "description": "DMS-931 follow-up: Add regression tests covering `rootTableNameOverride` collisions (root-vs-root and root-vs-child table name collisions). Acceptance: (1) A fixture where two resources in the same physical schema resolve to the same root table name via `relational.rootTableNameOverride` fails fast during derived model build; (2) a fixture where a resource root table name collides with another resource's child collection table name fails fast; (3) the exception message includes both resources and the colliding identifiers with actionable origins (resource label + JSON scope/path); (4) behavior is deterministic across resource ordering.",
    "steps-to-verify": [
      "Add a minimal hand-authored fixture under `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/set-builder/` containing two resources that collide via `rootTableNameOverride`.",
      "Add a second fixture where `rootTableNameOverride` produces a root table name that collides with another resource's derived child table name.",
      "Add a new NUnit fixture (e.g., `RootTableNameOverrideCollisionTests`) asserting the build throws `InvalidOperationException` with an actionable collision record.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Refactor",
    "description": "DMS-931 follow-up: Remove the unused `hasOverriddenAncestor` state in collection table derivation to reduce complexity. Acceptance: (1) `hasOverriddenAncestor` is either removed from `DeriveTableScopesAndKeysStep` / `ExtensionTableDerivationRelationalModelSetPass` (and any callers) or used for a clearly-defined behavior; (2) derived outputs are unchanged (goldens + unit tests stay green); (3) no dead code remains.",
    "steps-to-verify": [
      "Verify `hasOverriddenAncestor` is unused in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/DeriveTableScopesAndKeysStep.cs` and `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ExtensionTableDerivationRelationalModelSetPass.cs`.",
      "Remove the parameter and all plumbing (or introduce a tested behavior if it is intended to mean something).",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Cleanup",
    "description": "DMS-931 follow-up: Remove the unused legacy helper `RelationalNameConventions.ForeignKeyName` (superseded by `ConstraintNaming`) to prevent accidental divergence of naming rules. Acceptance: (1) The helper is removed and no call sites depend on it; (2) constraint naming uses `ConstraintNaming` consistently; (3) build and unit tests remain green.",
    "steps-to-verify": [
      "Confirm no usages of `RelationalNameConventions.ForeignKeyName` remain outside the helper itself.",
      "Remove the helper from `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalNameConventions.cs` (or mark obsolete and add a follow-up task to remove).",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Refactor",
    "description": "DMS-931 follow-up: Remove brittle runtime type assumptions in `ApplyDialectIdentifierShorteningRelationalModelSetPass.UpdateProjectSchemas`. Acceptance: (1) Dialect shortening can update `ProjectSchemasInEndpointOrder` without throwing when the backing collection is not a mutable array/list; (2) behavior remains deterministic and stable across runs; (3) unit tests cover schema-shortening behavior; (4) build and unit tests remain green.",
    "steps-to-verify": [
      "Refactor `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalModelSetBuilderContext.cs` to expose a consistently-mutable representation for `ProjectSchemasInEndpointOrder` (or provide an explicit mutation method) so passes do not depend on the concrete backing type.",
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ApplyDialectIdentifierShorteningRelationalModelSetPass.cs` to use the new mutation approach and remove the runtime type checks/throw.",
      "Add/adjust a unit test under `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/` that exercises schema shortening via a small `MaxIdentifierLength` and asserts updated `PhysicalSchema` values.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Testing",
    "description": "Add a new ds-5.2 golden test that validates reference binding by building a `DerivedRelationalModelSet` (set-level passes) and emitting a project-level manifest to a new expected fixture. Acceptance: (1) A new NUnit fixture builds a derived model set from `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/authoritative/ds-5.2/inputs/ds-5.2-api-schema-authoritative.json` using `RelationalModelSetPasses.CreateDefault()`; (2) it writes/diffs a new expected file `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/authoritative/ds-5.2/expected/authoritative-relational-model.derived.manifest.json`; (3) the derived manifest for `studentAssessmentRegistrations` includes reference-bound columns for the `StudentSchoolAssociation` reference (at minimum `StudentSchoolAssociation_DocumentId` and `StudentSchoolAssociation_StudentReferenceStudentUniqueId`) on the `StudentAssessmentRegistration` root table; (4) the existing per-resource ds-5.2 golden (`authoritative-relational-model.manifest.json`) remains unchanged and still passes.",
    "steps-to-verify": [
      "Add a new NUnit golden test file (e.g., `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/RelationalModelDerivedAuthoritativeGoldenTests.cs`) that loads the ds-5.2 project schema, builds an `EffectiveSchemaSet`, then builds a `DerivedRelationalModelSet` with `RelationalModelSetPasses.CreateDefault()` (plus an extension-site capture pass for per-resource emission).",
      "Emit the derived project-level manifest in the same top-level shape as the existing ds-5.2 manifest (`project_*` + `resources[]` with `resource_endpoint_name` + per-resource manifest), using `RelationalModelManifestEmitter.Emit(concrete.RelationalModel, extensionSites)` for each resource.",
      "Ensure the test writes an `actual` file under the test work directory and diffs it against the new expected fixture file, failing with the diff output when mismatched.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Confirm reference binding is present by searching the expected derived manifest for `StudentSchoolAssociation_DocumentId` and `StudentSchoolAssociation_StudentReferenceStudentUniqueId`.",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Fixtures",
    "description": "Add and maintain the derived ds-5.2 expected golden manifest for reference binding. Acceptance: (1) `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/authoritative/ds-5.2/expected/authoritative-relational-model.derived.manifest.json` exists in source control; (2) running the new derived golden test without `UPDATE_GOLDENS` produces no diff; (3) running with `UPDATE_GOLDENS=1` rewrites the file deterministically (stable ordering, LF-only, no trailing whitespace).",
    "steps-to-verify": [
      "Generate the expected derived manifest by running: `UPDATE_GOLDENS=1 dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Re-run the same test without `UPDATE_GOLDENS` and ensure it passes with an empty diff.",
      "Spot-check the expected derived manifest contains reference-bound columns for `studentAssessmentRegistrations` (e.g., `StudentSchoolAssociation_DocumentId`).",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Naming",
    "description": "Follow-up: Fix misleading override collision diagnostics for inside-reference identity overrides. Today `ReferenceBindingRelationalModelSetPass` uses the overridden identity-part base name when building the pre-override (`originalName`) identifier for reference identity columns, which can make collision messages show the wrong original identifier. Acceptance: (1) For reference identity columns derived in `ReferenceBindingRelationalModelSetPass` (scalar identity bindings and descriptor identity bindings), the `originalName` recorded for collision reporting reflects the pre-override identity part base name derived from `BuildIdentityPartBaseName(identityJsonPath)`; (2) final derived column names still reflect `relational.nameOverrides` applied to the reference identity JSONPath; (3) add a unit test fixture that forces a collision between two reference-identity columns after overrides and asserts the exception includes two distinct original identifiers and the shared final identifier; (4) unit tests pass and the DMS solution builds.",
    "steps-to-verify": [
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ReferenceBindingRelationalModelSetPass.cs` to keep `originalIdentityPartBaseName` separate from the overridden `identityPartBaseName` and use the original when constructing `originalColumnName` / `originalDescriptorColumnName` and when passing `originalName` to `TableColumnAccumulator` and `OverrideCollisionDetector`.",
      "Add a hand-authored fixture under `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/set-builder/` with a reference mapping that includes multiple `referenceJsonPaths` identity bindings and overrides those inside-reference identity paths to the same name to force a collision.",
      "Add an NUnit test (new or in an existing override test fixture) asserting the thrown `InvalidOperationException` message includes the two distinct original identifiers (pre-override) and the colliding final identifier (post-override).",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Testing",
    "description": "E02/E15 follow-up: Add regression tests that validate SQL/DDL emission always quotes identifiers (PostgreSQL double quotes, SQL Server brackets) to protect reserved-word and PascalCase identifiers. The current naming tests prove the model can contain reserved-looking identifiers (e.g., `Select`), but correctness depends on consistent quoting in SQL emission. Acceptance: (1) A test constructs a `DerivedRelationalModelSet` that includes at least one reserved-word-like schema/table/column name (e.g., `Select`) and runs the DDL emitter and/or plan compiler; (2) emitted SQL always quotes schema/table/column/constraint/index/trigger identifiers per dialect with no unquoted occurrences; (3) tests cover both `SqlDialect.Pgsql` and `SqlDialect.Mssql`; (4) tests are deterministic and run in CI without requiring a live database; (5) `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln` remains green.",
    "steps-to-verify": [
      "Implement (or extend) the SQL writer / DDL emitter / plan compiler layer to centralize identifier quoting (Pgsql: `\"name\"`, Mssql: `[name]`) and ensure every emitted identifier uses it.",
      "Add a unit test (or golden SQL snapshot test) that emits SQL for a fixture containing reserved-word-like identifiers and asserts quoting is applied to every identifier occurrence (schema, table, columns, constraints, indexes, triggers).",
      "Ensure the test runs for both dialects and fails if any unquoted identifier is emitted.",
      "Run: `dotnet test --no-restore ./src/dms/EdFi.DataManagementService.sln`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Design",
    "description": "Follow-up: Align index/trigger uniqueness validation with collision detection and documented dialect semantics. Today `RelationalModelSetBuilderContext` validates index/trigger uniqueness per `(schema, table, name)`, but `IdentifierCollisionDetector` treats indexes/triggers as schema-scoped during shortening collision detection. Acceptance: (1) Confirm the required uniqueness scope for index and trigger names per dialect (Pgsql vs Mssql) and document the chosen rule; (2) update `RelationalModelSetBuilderContext.ValidateIndexNameUniqueness/ValidateTriggerNameUniqueness` and `IdentifierCollisionDetector` scoping so they enforce the same rule (including any dialect-specific differences, if needed); (3) add unit tests that demonstrate allowed duplicates and expected failures for each dialect; (4) build and unit tests remain green.",
    "steps-to-verify": [
      "Document the index/trigger name uniqueness rule in `reference/design/backend-redesign/design-docs/data-model.md` (or a more appropriate design doc) with explicit scope for Pgsql and Mssql.",
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/RelationalModelSetBuilderContext.cs` uniqueness validators and `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/IdentifierCollisionDetector.cs` scopes to match the documented rule.",
      "Add unit tests under `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/` that construct duplicate index/trigger inventories and assert the correct validation behavior for both dialects.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Refactor",
    "description": "Refactor: Deduplicate collision detector implementations (`OverrideCollisionDetector` and `IdentifierCollisionDetector`) to reduce drift risk. These types share the same grouping/ordering/DistinctBy logic and shared-descriptor special-casing. Acceptance: (1) Extract a shared internal helper that encapsulates collection of sources, deterministic ordering, and record formatting; (2) keep observable behavior and exception messages stable (tests assert key substrings and should continue to pass); (3) code duplication is reduced materially (no parallel logic blocks for ordering and record generation); (4) unit tests pass and the DMS solution builds.",
    "steps-to-verify": [
      "Introduce a shared internal helper (e.g., `CollisionDetectorCore`) in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/` that supports both override-collision and shortening-collision scenarios.",
      "Refactor `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/OverrideCollisionDetector.cs` and `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/IdentifierCollisionDetector.cs` to delegate ordering/grouping/diagnostic formatting to the shared helper.",
      "Ensure all existing collision tests still pass (including `CollisionDetectorOriginTests`).",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Refactor",
    "description": "Refactor: Centralize truncate+hash identifier shortening utilities to avoid duplicated UTF-8 truncation logic. `ConstraintNaming` and `SqlDialectRulesUtilities` both implement nearly identical SHA-256 suffixing and UTF-8 byte truncation. Acceptance: (1) Remove duplicated truncation/hash implementation from one location by reusing a single shared helper; (2) preserve constraint shortening semantics (hash input is the canonical constraint signature, not the raw identifier) while reusing the shared truncation/length-unit handling; (3) `ConstraintNamingTests` and `SqlDialectRulesTests` remain green; (4) DMS solution builds.",
    "steps-to-verify": [
      "Extract a reusable helper in `./src/dms/backend/EdFi.DataManagementService.Backend.External/SqlDialectRules.cs` (or a new shared internal file) that supports suffixing a provided hash input with byte/char truncation.",
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ConstraintNaming.cs` to use the shared helper while still hashing the constraint signature, not the name string.",
      "Ensure `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ConstraintNamingTests.cs` assertions remain valid.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Refactor",
    "description": "Refactor: Remove duplicate JSONPath prefix logic by reusing `RelationalModelSetSchemaHelpers.IsPrefixOf` from schema input validation helpers. Today `ExtractInputsStep` contains an independent `IsSegmentPrefix` implementation. Acceptance: (1) `ExtractInputsStep` uses `RelationalModelSetSchemaHelpers.IsPrefixOf` for reference-object path prefix checks; (2) behavior is unchanged (all unit tests remain green); (3) duplicated prefix logic is removed.",
    "steps-to-verify": [
      "Replace `ExtractInputsStep.IsSegmentPrefix` usage with `RelationalModelSetSchemaHelpers.IsPrefixOf` and delete the local helper from `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ExtractInputsStep.cs`.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Refactor",
    "description": "Refactor: Consolidate `BuildReferenceIdentityPathSet` helper duplication to reduce drift between base traversal and input validation. This helper exists in both `ExtractInputsStep` and `DeriveColumnsAndBindDescriptorEdgesStep`. Acceptance: (1) Introduce a single shared helper for building the reference identity path set; (2) update both call sites to use it; (3) no behavior change; (4) unit tests pass and the DMS solution builds.",
    "steps-to-verify": [
      "Create a shared helper (e.g., in `RelationalModelSetSchemaHelpers` or a new internal static class) that returns the canonical reference identity path set from `IReadOnlyList<DocumentReferenceMapping>`.",
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/ExtractInputsStep.cs` and `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/DeriveColumnsAndBindDescriptorEdgesStep.cs` to call the shared helper and remove duplicated implementations.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Refactor",
    "description": "Refactor: Clarify and potentially reduce redundant override-collision tracking between `TableColumnAccumulator` and `OverrideCollisionDetector`. Most per-table column collisions are already detected at insertion time by `TableColumnAccumulator`, while `OverrideCollisionDetector` re-registers many of the same columns. Acceptance: (1) Define a single, clear responsibility split (e.g., `TableColumnAccumulator` for per-table column collisions; `OverrideCollisionDetector` for cross-resource table collisions and non-accumulator-derived identifiers like key columns); (2) remove redundant `OverrideCollisionDetector.RegisterColumn` calls where they provide no additional coverage, without losing actionable diagnostics; (3) all naming/override collision tests remain green (including naming-stress collision fixture); (4) DMS solution builds.",
    "steps-to-verify": [
      "Audit override collision reporting paths and identify which collisions are already caught by `TableColumnAccumulator` vs those only detectable via `OverrideCollisionDetector` (e.g., root table naming collisions, key column collisions).",
      "Update pass/step implementations to register only the identifiers that require set-level tracking; remove redundant registrations for columns that cannot collide outside a table or are already guarded at insertion time.",
      "Ensure collision diagnostics remain actionable and deterministic across resource ordering.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Design",
    "description": "RelationalModel folder restructure: Define and approve a target folder taxonomy for `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/` aligned to the current pipeline and pass architecture. Write it to FOLDER-RESTRUCTURE.md file. Acceptance: (1) A documented mapping exists from every current top-level `.cs` file to exactly one target folder; (2) target folders include at minimum `Build/`, `Build/Steps/`, `SetPasses/`, `Schema/`, `Validation/`, `Naming/`, `Constraints/`, and `DescriptorPaths/`; (3) the mapping keeps public API discoverable by grouping orchestration types (`RelationalModelBuilderPipeline`, `RelationalModelSetPasses`, `DerivedRelationalModelSetBuilder`) under `Build/`; (4) no implementation code changes are required in this planning task.",
    "steps-to-verify": [
      "Create a file-to-folder mapping checklist that covers all files currently under `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/`.",
      "Confirm each file appears once in the mapping and no file is left unassigned.",
      "Confirm folder names and groupings match the accepted taxonomy.",
      "Run: `rg --files ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel | wc -l` and compare to the number of mapped files."
    ],
    "completed": true
  },
  {
    "category": "Refactor",
    "description": "RelationalModel folder restructure phase 1: Move files into the new folders without changing type names, namespaces, or behavior. Acceptance: (1) Files are moved from project root into approved folders (`Build`, `Build/Steps`, `SetPasses`, `Schema`, `Validation`, `Naming`, `Constraints`, `DescriptorPaths`, and optionally `Diagnostics`); (2) all moved files retain `namespace EdFi.DataManagementService.Backend.RelationalModel;`; (3) no public type names change in this phase; (4) project compiles and unit tests pass unchanged.",
    "steps-to-verify": [
      "Move the files according to the approved mapping in FOLDER-RESTRUCTURE.md file while preserving filenames and namespaces.",
      "Confirm no class/record/interface/enum name changes occurred by running: `rg -n \"^(public|internal)\\s+(sealed\\s+|abstract\\s+)?(class|record|interface|enum)\\s+\" ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel`.",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`."
    ],
    "completed": true
  },
  {
    "category": "Refactor",
    "description": "RelationalModel cleanup phase 2: Split multi-type files into one-public-type-per-file for orchestration and context types to improve discoverability. Private types should stay with the type that uses them, unless they are shared and must become public types. Acceptance: (1) `RelationalModelBuilderPipeline.cs` is split so `IRelationalModelBuilderStep`, `RelationalModelBuilderContext`, `DescriptorPathSource`, `RelationalModelBuildResult`, and `RelationalModelBuilderPipeline` live in separate files with matching filenames; (2) large context-holder files with multiple public types (e.g., set builder context records/classes) are similarly split where practical; (3) behavior and public API signatures remain unchanged; (4) build and tests remain green.",
    "steps-to-verify": [
      "Create separate files for each public type currently co-located in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Build/RelationalModelBuilderPipeline.cs` (or its moved location).",
      "Split additional multi-type orchestration/context files where they contain multiple public types and preserve signatures.",
      "Run: `rg -n \"^public\\s\" ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel` to confirm one public type per target file in the split scope.",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`."
    ],
    "completed": true
  },
  {
    "category": "Refactor",
    "description": "RelationalModel optional phase 3: Rename set-pass type and file names from `*RelationalModelSetPass` to `*Pass` for readability while preserving semantics and ordering. Acceptance: (1) Each set-pass type/file pair is renamed consistently (for example, `ReferenceBindingRelationalModelSetPass` -> `ReferenceBindingPass`); (2) `RelationalModelSetPasses.CreateDefault()` order remains unchanged; (3) all references in production code and tests compile; (4) existing behavior remains unchanged as demonstrated by green tests.",
    "steps-to-verify": [
      "Rename set-pass files and type declarations under `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/` using a consistent `*Pass` suffix.",
      "Update constructor calls and references in `RelationalModelSetPasses`, production code, and unit tests to the new names.",
      "Confirm pass ordering is unchanged by validating `RelationalModelSetPassesTests`.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`.",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`."
    ],
    "completed": true
  },
  {
    "category": "Documentation",
    "description": "RelationalModel documentation update: Reflect the new folder layout and naming conventions in project docs so contributors can navigate the codebase quickly. Acceptance: (1) `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/README.md` includes the new folder taxonomy and a short responsibility summary for each folder; (2) if phase-3 renames are executed, README examples and terminology use the new pass names; (3) documentation does not contradict code structure; (4) build/test commands in docs remain valid.",
    "steps-to-verify": [
      "Update the README section that explains pipeline architecture to include folder-level organization.",
      "If pass renames were applied, update examples and references to `*Pass` names.",
      "Verify referenced file paths and symbols exist by spot-checking with `rg --files` and `rg -n`.",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`."
    ],
    "completed": true
  },
  {
    "category": "Verification",
    "description": "RelationalModel restructure validation: Execute end-to-end verification after folder moves and optional renames to ensure no regressions. Acceptance: (1) RelationalModel unit tests pass; (2) DMS solution build succeeds; (3) no accidental namespace changes are introduced outside planned scope; (4) `tasks.json` entries for this restructure can be marked complete only after the commands and checks pass.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`.",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`.",
      "Run: `rg -n \"^namespace \" ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel` and confirm expected namespace declarations.",
      "Review `git diff --name-status` to ensure file moves/renames align with the approved mapping and no unrelated files were modified."
    ],
    "completed": true
  },
  {
    "category": "Backend",
    "description": "DMS-931 follow-up: Make `_ext` project-key resolution case-insensitive across all derivation paths. Acceptance: (1) `_ext` endpoint/project-name matching uses case-insensitive comparison semantics (or a single canonical normalization) in every resolution path, including `RelationalModelSetBuilderContext`, `ExtractInputsStep`, and `ExtensionTableDerivationPass`; (2) mixed-case project keys (for example `EdFi.TPDM_ext` vs `edfi.tpdm_ext`) resolve to the same extension project and do not fail derivation/startup; (3) behavior is consistent between schema input extraction and extension table derivation; (4) non-extension matching behavior is unchanged.",
    "steps-to-verify": [
      "Replace case-sensitive `_ext` project-name matching in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Build/RelationalModelSetBuilderContext.cs`, `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Build/Steps/ExtractInputsStep.cs`, and `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ExtensionTableDerivationPass.cs` with a single case-insensitive strategy.",
      "Add/adjust unit tests in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ExtensionProjectKeyResolutionTests.cs` to assert mixed-case `_ext` keys resolve successfully through the affected code paths.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`.",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`."
    ],
    "completed": true
  },
  {
    "category": "Backend",
    "description": "DMS-931 follow-up: Implement deterministic primary-key constraint naming and include PK constraints in dialect hashing/shortening flows. Acceptance: (1) relational model types carry PK constraint names (not just key columns) so PK identity is part of the derived model contract; (2) PK names are generated deterministically as `PK_{TableName}` before dialect processing; (3) PK constraint identifiers participate in the same hashing/shortening/collision handling as other named constraints; (4) emitted DDL includes explicit named PK constraints and uses the final dialect-safe identifier; (5) behavior is covered by unit tests for both normal and overlong/collision-prone table names.",
    "steps-to-verify": [
      "Extend relational model contracts in `./src/dms/backend/EdFi.DataManagementService.Backend.External/RelationalModelTypes.cs` and corresponding builder code so each table primary key has a constraint name.",
      "Update passes in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ApplyConstraintDialectHashingPass.cs` and `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ApplyDialectIdentifierShorteningPass.cs` to process PK constraints alongside other named constraints.",
      "Update DDL emission in `./src/dms/backend/EdFi.DataManagementService.Backend.Ddl/RelationalModelDdlEmitter.cs` to emit `CONSTRAINT <name> PRIMARY KEY (...)` using the finalized identifier.",
      "Add/adjust unit tests in RelationalModel and DDL test projects to assert deterministic PK naming, dialect shortening/hashing participation, and emitted SQL text.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.Ddl.Tests.Unit/EdFi.DataManagementService.Backend.Ddl.Tests.Unit.csproj`.",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`."
    ],
    "completed": true
  },
  {
    "category": "Testing",
    "description": "DMS-931 follow-up: Add explicit regression coverage for case-insensitive `_ext` project-key resolution requirements from extensions design docs. Acceptance: (1) tests include at least one mixed-case `_ext` key scenario that previously failed under `StringComparison.Ordinal`; (2) tests verify resolution succeeds regardless of casing and remains deterministic; (3) tests include at least one negative case where the project key truly does not match and still fails with expected diagnostics.",
    "steps-to-verify": [
      "Add new test cases to `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ExtensionProjectKeyResolutionTests.cs` covering mixed-case positive and true-mismatch negative scenarios.",
      "Ensure expected diagnostics/assertions reflect case-insensitive matching semantics for `_ext` keys.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`."
    ],
    "completed": true
  },
  {
    "category": "Backend",
    "description": "Bugfix: Correct document-reference propagated identity column naming to be derived from the reference object's identity-field paths (relative to `referenceObjectPath`) instead of concatenating the target resource identity JSONPath segments. This prevents intermediate `*Reference` segments from leaking into column names and avoids unnecessary dialect shortening/hashing caused by inflated identifiers. Acceptance: (1) Add a helper (e.g., `BuildReferenceIdentityFieldBaseName(referenceObjectPath, referenceValuePath)`) that validates `referenceValuePath` is under `referenceObjectPath`, strips the shared prefix segments, rejects array segments in the remainder, and produces a PascalCased base name from the remaining property segments; (2) `ReferenceBindingPass` and `ReferenceConstraintPass` use the reference-relative base name for `{ReferenceBaseName}_{IdentityFieldBaseName}` identity columns, while still using the target `IdentityJsonPath` only for semantic binding/descriptor detection; (3) the derived model no longer emits names like `ClassPeriod_SchoolReferenceSchoolId` or `Calendar_SchoolYearTypeReferenceSchoolYear` and instead emits `ClassPeriod_SchoolId` and `Calendar_SchoolYear`; (4) the `StudentHomelessProgramAssociation` -> `Program` FK identity column no longer includes the substring `EducationOrganizationReference` and is emitted as `ProgramProgram_EducationOrganizationId` (and therefore does not require shortening solely due to the leaked substring); (5) non-reference scalar/identity column naming behavior is unchanged.",
    "steps-to-verify": [
      "Implement the reference-relative identity-field base-name helper in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Schema/RelationalModelSetSchemaHelpers.cs` with fail-fast validation when the reference value path is not a descendant of the reference object path or when the remainder is empty/contains array segments.",
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ReferenceBindingPass.cs` to derive `identityPartBaseName` from the reference-side path (relative to `mapping.ReferenceObjectPath`), not from `identityBinding.IdentityJsonPath`.",
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ReferenceConstraintPass.cs` to resolve identity binding columns using the same reference-relative base-name rule so constraint derivation matches the updated column names.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Testing",
    "description": "Regression: Add explicit coverage and update authoritative expected outputs for reference identity column naming to ensure `*Reference` substrings never appear in propagated identity column names unless they are part of the actual reference field path. Acceptance: (1) Unit/regression coverage includes at least one case where the target identity path includes nested reference objects (e.g., `...SchoolReference.schoolId`) but the reference object supplies flattened identity fields (e.g., `...schoolId`), and asserts the column uses the flattened identity field name; (2) Update authoritative `ds-5.2` expected manifest so it contains `ClassPeriod_SchoolId`, `Calendar_SchoolYear`, and `ProgramProgram_EducationOrganizationId` (no `EducationOrganizationReference` substring and no hash shortening caused only by the leaked substring); (3) `UPDATE_GOLDENS=1` test run produces a stable, minimal diff and a subsequent plain test run passes; (4) `dotnet build` succeeds for the DMS solution.",
    "steps-to-verify": [
      "Add/extend unit tests under `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/` to cover reference-relative identity-field naming (including at least one `SchoolId`, `SchoolYear`, and `EducationOrganizationId`-style identity component).",
      "Regenerate goldens: `UPDATE_GOLDENS=1 dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Verify the regenerated `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/authoritative/ds-5.2/expected/authoritative-relational-model.derived.manifest.json` includes `ClassPeriod_SchoolId`, `Calendar_SchoolYear`, and `ProgramProgram_EducationOrganizationId` and does not include the incorrect `*Reference*`-inflated variants for those sites.",
      "Run again without updates to confirm determinism: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Naming",
    "description": "PR 816 review (2026-02-09): Make `ConstraintNaming.BuildColumnTokens` deterministic regardless of input column ordering by sorting `prefixOrder` before iteration. Acceptance: (1) the same set of columns in any order yields identical token sequences and constraint identifiers; (2) ordering uses `StringComparer.Ordinal`; (3) unit test covers a swapped-input-order scenario and asserts identical results.",
    "steps-to-verify": [
      "Update `BuildColumnTokens` in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Constraints/ConstraintNaming.cs` to iterate prefixes in a deterministic order (e.g., `prefixOrder.OrderBy(p => p, StringComparer.Ordinal)`).",
      "Add/extend unit test coverage to assert that `BuildColumnTokens` (or a higher-level constraint naming API) returns identical output for the same columns provided in different orders.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Backend",
    "description": "PR 816 review (2026-02-09): Make `ConstraintIdentity` enforce non-null `TargetTable` for ForeignKey identities and align `Equals`/`GetHashCode`. Acceptance: (1) `GetHashCode` no longer hashes `TargetTable.GetValueOrDefault()` for ForeignKey identities; null `TargetTable` is treated as invalid (fail fast with a clear exception); (2) behavior for valid ForeignKey identities remains deterministic (equal identities produce equal hash codes); (3) unit tests pass.",
    "steps-to-verify": [
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Constraints/ConstraintIdentity.cs` so when `Kind` is ForeignKey, hashing requires `TargetTable` to be non-null (e.g., throw `InvalidOperationException` with a clear message) and hashes `TargetTable.Value`.",
      "Add/adjust unit test coverage to assert that two identical ForeignKey identities compare equal and have identical hash codes.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Backend",
    "description": "PR 816 review (2026-02-09): Clarify/guard `TableColumnAccumulator` seeding for key columns that overlap regular columns. Acceptance: (1) key-column overlap with `DbTableModel.Columns` is explicitly documented as expected; (2) if a key column is missing from `DbTableModel.Columns`, fail fast with a clear exception that includes the table and column name; (3) unit test covers the missing-key-column case deterministically.",
    "steps-to-verify": [
      "Update `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Diagnostics/TableColumnAccumulator.cs` to document why key-column overlap is expected and to throw if a `table.Key.Columns` entry is not present in `table.Columns`.",
      "Add a unit test that constructs an inconsistent `DbTableModel` (key column missing from `Columns`) and asserts the exception message includes the table and missing column name.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Testing",
    "description": "PR 816 review (2026-02-09): Document reserved-keyword DDL quoting coverage (already provided by `DdlIdentifierQuotingTests`) and cross-reference it from naming stress tests. Acceptance: (1) `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/DdlIdentifierQuotingTests.cs` proves reserved identifier `Select` is quoted in Pgsql and Mssql DDL and that no unquoted occurrences appear; (2) `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/NamingStressFixtureTests.cs` includes a comment pointing to `DdlIdentifierQuotingTests` to show reserved keyword handling is covered end-to-end; (3) unit tests pass.",
    "steps-to-verify": [
      "Confirm `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/DdlIdentifierQuotingTests.cs` explicitly covers a reserved keyword identifier (e.g., `Select`) and asserts quoted DDL output for Pgsql and Mssql.",
      "Add a short comment in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/NamingStressFixtureTests.cs` near the `Select` assertion pointing to `DdlIdentifierQuotingTests`.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Testing",
    "description": "PR 816 review (2026-02-09): Strengthen override collision diagnostic assertions in `NamingStressFixtureTests` to pin the collision name (`Duplicate`) and keep context stable. Acceptance: (1) assertions verify both colliding paths (`$.firstName`, `$.lastName`) and the collision identifier (`Duplicate`) are present; (2) assertions verify scope context (e.g., table `edfi.CollisionTest`) is present; (3) assertions are order-insensitive and deterministic.",
    "steps-to-verify": [
      "Update the collision test in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/NamingStressFixtureTests.cs` to assert the error message includes both colliding paths and the collision identifier `Duplicate`, plus relevant scope context.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Testing",
    "description": "PR 816 review (2026-02-09): Add a reversed-resource-ordering collision test to `NameOverrideTests` to guarantee deterministic collision detection across resource ordering. Acceptance: (1) collision detection produces the same exception type and message with normal and reversed resource ordering; (2) both paths are covered by unit tests to prevent regressions.",
    "steps-to-verify": [
      "Following the pattern in `RootTableNameOverrideCollisionTests.cs`, add a parallel test in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/NameOverrideTests.cs` that runs the same scenario with reversed resource ordering and asserts an identical exception message.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Testing",
    "description": "PR 816 review (2026-02-09): Add cross-dialect identifier-shortening comparison coverage to ensure PostgreSQL (63-byte) and SQL Server (128-char) limits produce different results for the same long identifier. Acceptance: (1) a single long identifier yields different shortened results across dialects; (2) each result respects its dialect maximum length; (3) test asserts concrete expected behavior and is deterministic.",
    "steps-to-verify": [
      "Add a new test case to `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/DialectIdentifierShorteningTests.cs` that shortens the same long identifier under both dialect rules and asserts the results differ while still meeting each dialect length constraint.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Documentation",
    "description": "PR 816 review (2026-02-09): Document that `relational.nameOverrides` values may normalize to SQL reserved words and this is safe because all identifiers are quoted in DDL emission. Acceptance: (1) `RelationalOverridesExtractor` includes a comment explaining reserved-word overrides are allowed and points to `DdlIdentifierQuotingTests`; (2) no functional behavior changes; (3) unit tests pass.",
    "steps-to-verify": [
      "Add a short comment in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Build/Steps/ExtractInputs/RelationalOverridesExtractor.cs` near override normalization documenting that reserved words are allowed because identifiers are quoted in DDL emission (cross-reference `DdlIdentifierQuotingTests`).",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": false
  },
  {
    "category": "Documentation",
    "description": "PR 816 review (2026-02-09): Reword the misleading comment in `CollisionDetectorCore` to state that shared descriptor elements are collapsed when `isSharedDescriptorElement` returns true (not \"optionally\"). Acceptance: (1) comment accurately reflects the predicate-driven behavior; (2) no functional code changes.",
    "steps-to-verify": [
      "Update the comment in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Diagnostics/CollisionDetectorCore.cs` to remove ambiguity and match behavior.",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Diagnostics",
    "description": "PR 816 review (2026-02-09): Improve `DescriptorPathInference` conflict error message so it clearly indicates conflicting descriptor resources for the same path. Acceptance: (1) message includes the canonical path plus both the existing and encountered descriptor resource names; (2) message text is validated by a unit test; (3) no behavior change beyond clearer diagnostics.",
    "steps-to-verify": [
      "Update the conflict diagnostic message in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/DescriptorPaths/DescriptorPathInference.cs` to explicitly name both descriptor resources and the canonical path.",
      "Update/add a unit test to assert the new message content for a conflict scenario.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Diagnostics",
    "description": "PR 816 review (2026-02-09): When validating schema projects lists, include the index of any null project entry in the error message to aid debugging. Acceptance: (1) exception message includes the 0-based index (or explicitly documented indexing) of the null entry; (2) unit test covers null-at-index scenario and asserts the message includes the index.",
    "steps-to-verify": [
      "Update projects list validation in `./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/DescriptorPaths/DescriptorPathInference.cs` (or the relevant validation helper it calls) to track and report the index when encountering a null entry.",
      "Update/add a unit test asserting the error message includes the offending index.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  }
]
