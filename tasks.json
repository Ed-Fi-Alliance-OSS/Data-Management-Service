[
  {
    "category": "Type Mapping",
    "description": "Make `type: \"number\"` scalar mapping require `decimalPropertyValidationInfos` with both `totalDigits` and `decimalPlaces`. Acceptance: deriving columns throws a deterministic schema-compilation error when a number property has no matching entry, or has an entry with `totalDigits`/`decimalPlaces` missing; the exception message includes the canonical JSON path (e.g., `$.amount`).",
    "steps-to-verify": [
      "Update column derivation so a `type:number` property without a matching `decimalPropertyValidationInfos` entry fails fast (no default `Decimal` type).",
      "Update tests so the former \"allow decimals without validation\" scenario now asserts an exception containing the property JSON path.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.Tests.Unit/EdFi.DataManagementService.Backend.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Model Semantics",
    "description": "Align `DbTableModel.Columns` semantics with the flattening/reconstitution design contract: `Columns` is the single ordered column list used for plan compilation (it must include key columns + ordinals + FKs + scalars), while `TableKey` remains the PK subset. Acceptance: each tableâ€™s `Columns` list begins with its key columns in stable key order (root: `DocumentId`; child: `{Root}_DocumentId`, ancestor ordinals, `Ordinal`) before non-key columns; root key column kind matches the design; canonical ordering keeps key columns first; manifest output reflects this.",
    "steps-to-verify": [
      "Update derivation so key columns are also emitted as `DbColumnModel` entries and included at the start of `DbTableModel.Columns` in stable key order (keep `TableKey` as the PK subset).",
      "Update canonical ordering/manifest output and unit tests (and any golden manifest) to assert the full column inventory includes the key columns and that they remain first.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.Tests.Unit/EdFi.DataManagementService.Backend.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Schema Validation",
    "description": "Enforce the design contract for arrays: arrays must have `items.type: \"object\"`, except descriptor reference collections may be arrays of scalar descriptor values (with the wildcard element path present in `documentPathsMapping` as a descriptor path, e.g., `$.gradeLevelDescriptors[*]`). Acceptance: descriptor scalar arrays compile and derive a child table with parent key parts + `Ordinal` + a single `..._DescriptorId` column (and a `DescriptorEdgeSource`); any non-descriptor scalar array fails schema compilation with an error message that includes the canonical array path.",
    "steps-to-verify": [
      "Update validation and column derivation to allow `type:array` with scalar `items.type` only when the wildcard element path (e.g., `$.gradeLevelDescriptors[*]`) is present in `DescriptorPathsByJsonPath`.",
      "Add unit test: a descriptor scalar array derives a child table and adds exactly one descriptor FK column (`ColumnKind=DescriptorFk`) plus a matching `DescriptorEdgeSource`.",
      "Add unit test: a non-descriptor scalar array fails fast with an exception message containing the canonical array path (e.g., `$.tags`).",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.Tests.Unit/EdFi.DataManagementService.Backend.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Schema Traversal",
    "description": "Add explicit coverage proving `additionalProperties` is ignored for persistence (closed-world mapping). Acceptance: no columns or tables are derived from schemas found under `additionalProperties` (boolean or schema form), and manifests for fixtures with/without `additionalProperties` are identical when `properties` are identical.",
    "steps-to-verify": [
      "Add a unit test schema where `additionalProperties` is an object schema that would otherwise produce columns if traversed, and assert those columns are not derived.",
      "Add a unit test that compares manifests for two schemas that differ only by `additionalProperties` and asserts byte-for-byte equality.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.Tests.Unit/EdFi.DataManagementService.Backend.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Determinism",
    "description": "Eliminate duplicated ordering logic between canonicalization and manifest emission to prevent drift. Acceptance: ordering rules live in one place; after `CanonicalizeOrderingStep`, the emitter serializes in stored order (no re-sorting); a regression test fails if emitter ordering diverges from canonical ordering.",
    "steps-to-verify": [
      "Refactor ordering so the manifest emitter does not independently sort tables/columns/constraints (or centralize shared ordering helpers used by both).",
      "Add a unit test that constructs a model with intentionally unsorted input lists, runs canonicalization, emits a manifest, and asserts the manifest ordering matches the canonicalized in-memory ordering exactly.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.Tests.Unit/EdFi.DataManagementService.Backend.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Diagnostics",
    "description": "Improve column name collision diagnostics for inlined-object prefixing and PascalCase normalization. Acceptance: when a collision occurs, the exception message includes the table name, the physical column name, and the canonical JSON paths for both colliding sources, and suggests using `relational.nameOverrides` to resolve it.",
    "steps-to-verify": [
      "Add a unit test with two properties that collapse to the same PascalCase column name (e.g., `ab` and `a-b`) and assert the thrown exception contains both source paths and the column name.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.Tests.Unit/EdFi.DataManagementService.Backend.Tests.Unit.csproj`"
    ],
    "completed": false
  },
  {
    "category": "Constraints",
    "description": "Extend `TableConstraint.ForeignKey` to represent referential actions (`ON DELETE` / `ON UPDATE`) so DDL emission and manifests do not re-derive cascade semantics. Acceptance: the derived model specifies actions for key scenarios (root `DocumentId` FK to `dms.Document` is `ON DELETE CASCADE`; parent->child table FKs for collections are `ON DELETE CASCADE`; reference-identity composite FKs use `ON UPDATE CASCADE`; descriptor FKs default to `NO ACTION`/`RESTRICT`), and `RelationalModelManifestEmitter` serializes these actions deterministically.",
    "steps-to-verify": [
      "Update `TableConstraint.ForeignKey` model to include `OnDelete` and `OnUpdate` (enum values covering at least `NoAction` and `Cascade`).",
      "Update derivation steps to set the appropriate referential actions for root/collection/reference/descriptor foreign keys per the design docs.",
      "Update `RelationalModelManifestEmitter` to include `on_delete` and `on_update` fields for foreign keys, and update any golden manifests accordingly.",
      "Add unit tests asserting the referential actions on derived foreign keys (root document FK, parent-child FK, and a reference-identity FK case).",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.Tests.Unit/EdFi.DataManagementService.Backend.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  }
]
