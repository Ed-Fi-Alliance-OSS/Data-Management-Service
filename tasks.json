[
  {
    "category": "Contracts",
    "description": "Evolve `AbstractUnionViewInfo` in `src/dms/backend/EdFi.DataManagementService.Backend.External/DerivedRelationalModelSetContracts.cs` into the richer dialect-agnostic union-view contract: (1) view contract = `ViewName` + ordered output columns (column name + canonical `RelationalScalarType` + optional `SourceJsonPath`/`TargetResource` for diagnostics), (2) fully explicit ordered `UnionArms`, each with concrete member resource identity, `FromTable` (root table), and a projection list aligned 1:1 with output columns, (3) minimal projection expression AST supporting `SourceColumn(DbColumnName)` and `StringLiteral(value)`; no embedded SQL. Acceptance: the new contract is sufficient for DDL emission to format deterministic `UNION ALL` views without consulting ApiSchema, and it remains mechanically rewritable by identifier-shortening (tables/columns embedded in the model).",
    "steps-to-verify": [
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Derivation",
    "description": "Implement abstract union-view derivation in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel` (new set-pass or extend `AbstractIdentityTableDerivationPass`) so every abstract resource derives BOTH `{schema}.{AbstractResource}Identity` and `{schema}.{AbstractResource}_View`. Acceptance: (a) identity-table columns are ordered `DocumentId`, then abstract identity columns in `identityJsonPaths` order, then `Discriminator` last (always present, NOT NULL), (b) view output columns match the same order and types, (c) `Discriminator` value per arm is exactly `\"ProjectName:ResourceName\"` and fails fast if > 256 chars, (d) union arms are ordered by concrete member `ResourceName` using ordinal ordering and fail fast if any two members share the same `ResourceName` across projects, (e) `superclassIdentityJsonPath` rename mapping is honored regardless of `subclassType`, (f) fail fast if any mapped member identity source column is nullable (`IsNullable=true`), (g) fail fast if any participating concrete member cannot supply every abstract identity field, (h) fail fast if an abstract resource has zero concrete members in the effective schema set, and (i) fail fast if a subclass’s superclass is not an abstract resource (subclass-of-subclass is not permitted).",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Pass Ordering",
    "description": "Update `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Build/RelationalModelSetPasses.cs` so abstract identity-table + union-view derivation runs after reference binding (so propagated reference-identity columns exist on concrete roots) but before reference-constraint derivation (which consumes abstract identity tables). Acceptance: default model-set build succeeds for authoritative/small fixtures that include polymorphic identities with reference-sourced identity parts (e.g., `GeneralStudentProgramAssociation`), without schema-fallback guesswork for union-view source columns.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Identifier Shortening",
    "description": "Update `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ApplyDialectIdentifierShorteningPass.cs` to support the new union-view shape: shorten `ViewName`, view output column names, each arm’s `FromTable`, and any `SourceColumn(DbColumnName)` references inside projections; include these identifiers in collision validation. Acceptance: shortening produces a self-consistent model where union-view arms reference the same shortened table/column identifiers as the concrete-resource models, and collision detection reports actionable failures when shortening would collide.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Tests",
    "description": "Add/extend NUnit unit tests (FluentAssertions) in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit` to cover polymorphic union views. Acceptance: tests assert (1) output column ordering = `DocumentId`, identity columns in `identityJsonPaths` order, `Discriminator` last, (2) arm ordering determinism by `ResourceName` ordinal, (3) realistic rename mapping works: e.g., `School.schoolId` projects into abstract `EducationOrganization.educationOrganizationId` output column when `superclassIdentityJsonPath=$.educationOrganizationId`, (4) extension project adds a new abstract subclass member and is included as an arm with `Discriminator` formatted `\"ProjectName:ResourceName\"`, (5) fail-fast on missing identity field in any member, (6) fail-fast on duplicate member `ResourceName` across projects, and (7) fail-fast when discriminator would exceed 256 chars (use long project/resource names).",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Refactoring",
    "description": "Update all impacted builders/tests that construct `AbstractUnionViewInfo` (e.g., `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/DerivedRelationalModelSetBuilderOrderingTests.cs` and any identifier-shortening tests) to use the new structured contract (columns + arms + projection AST). Acceptance: no compile breaks across backend projects; existing ordering/quoting/shortening tests are updated to create minimal-but-valid union view models.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.Ddl.Tests.Unit/EdFi.DataManagementService.Backend.Ddl.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Build",
    "description": "Run full build + relevant unit tests to validate the integrated change set. Acceptance: `./src/dms/EdFi.DataManagementService.sln` builds cleanly and the backend unit test suites pass after the contract evolution and new derivation logic.",
    "steps-to-verify": [
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.Ddl.Tests.Unit/EdFi.DataManagementService.Backend.Ddl.Tests.Unit.csproj`"
    ],
    "completed": true
  }
]
