[
  {
    "category": "Contracts",
    "description": "Introduce synthetic presence hardening via `TableConstraint.NullOrTrue`. Acceptance: `src/dms/backend/EdFi.DataManagementService.Backend.External/RelationalModelTypes.cs` defines `TableConstraint.NullOrTrue(string Name, DbColumnName Column)`; `ConstraintIdentity`/`ConstraintNaming`/`ApplyConstraintDialectHashingPass`/`ApplyDialectIdentifierShorteningPass`/`RelationalModelOrdering` support this new constraint kind; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Build/RelationalModelManifestEmitter.cs` serializes it deterministically; and `src/dms/backend/EdFi.DataManagementService.Backend.Ddl/RelationalModelDdlEmitter.cs` emits a dialect-appropriate CHECK expression (`<col> IS NULL OR <col> = TRUE/1`) so DDL unit tests stay green.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.Ddl.Tests.Unit/EdFi.DataManagementService.Backend.Ddl.Tests.Unit.csproj`",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Key Unification",
    "description": "Align `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs` to `reference/design/backend-redesign/design-docs/key-unification.md`: resolve equality-constraint endpoints strictly by exact `DbColumnModel.SourceJsonPath.Canonical` match (delete `FindReferenceRelativeAliasCandidates` and `TryResolveAmbiguousReferenceEndpoint` heuristics), fail fast on unresolved/ambiguous endpoints and unsupported endpoint kinds (only `Scalar` and `DescriptorFk`), classify every `resourceSchema.equalityConstraints` entry deterministically as `applied`/`redundant`/`ignored(cross_table)` for manifest emission, and build per-table connected components for `applied` edges. For each same-table unification class: add exactly one canonical stored column (`SourceJsonPath=null`), convert each member path column to `ColumnStorage.UnifiedAlias(canonical, presence?)`, gate reference-identity members by `{RefBaseName}_DocumentId`, gate optional non-reference members by synthetic nullable-boolean `{MemberColumn}_Present` (stored, `SourceJsonPath=null`) + one `TableConstraint.NullOrTrue` hardening CHECK per synthetic presence column, and leave required non-reference members ungated. Acceptance: `DbTableModel.KeyUnificationClasses` is populated with stable ordering (class order + member order) and no FK references any `UnifiedAlias` or synthetic presence-flag columns.",
    "steps-to-verify": [
      "Add/extend unit tests in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/KeyUnificationPassTests.cs` for strict endpoint resolution (unresolved/ambiguous), applied/redundant/ignored classification, reference-site gating via `..._DocumentId`, and optional scalar/descriptor gating via synthetic `..._Present` + `NullOrTrue`.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Descriptor FKs",
    "description": "Refactor descriptor FK constraint emission into a post-unification set-level pass. Acceptance: remove early descriptor FK constraint creation in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ReferenceBindingPass.cs` and `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ExtensionTableDerivationPass.cs`; add a new pass (wired into `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Build/RelationalModelSetPasses.cs` after `KeyUnificationPass` and before any constraint hashing/shortening) that maps each descriptor binding column (`ColumnKind.DescriptorFk`) to its storage column via `DbColumnModel.Storage` (canonical when unified), emits exactly one FK to `dms.Descriptor(DocumentId)` per `(table, storage_column)` pair, and records deterministic `descriptor_fk_deduplications[]` diagnostics when multiple binding columns map to the same storage column; constraint names are derived from `(table, storage_column)` so they are stable under de-dup.",
    "steps-to-verify": [
      "Add a unit test where two descriptor binding columns unify to one canonical storage column and assert only one descriptor FK constraint exists and `ValidateForeignKeyStorageInvariantPass` remains satisfied.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Reference Constraints",
    "description": "Update (or validate) `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ReferenceConstraintPass.cs` behavior under unification. Acceptance: composite reference FKs map both local and target identity-part columns through `DbColumnModel.Storage` (via `UnifiedAliasStorageResolver`) and de-duplicate repeated canonical storage columns after mapping while preserving `identityJsonPaths` order; FK-supporting referenced-key UNIQUE constraints use the mapped (and de-duplicated) target storage columns; and all-or-none CHECK constraints remain on binding/path columns (including aliases) + `..._DocumentId` (no storage mapping).",
    "steps-to-verify": [
      "Add/extend unit tests in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ConstraintDerivationRelationalModelSetPassTests.cs` that exercise identity-part unification causing duplicate storage columns and assert FK/UK dedup with stable ordering.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Dialect Shortening",
    "description": "Fix dialect shortening for key unification metadata. Acceptance: `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ApplyDialectIdentifierShorteningPass.cs` rewrites all key-unification references when identifiers shorten: `ColumnStorage.UnifiedAlias` pointers (canonical/presence), `DbTableModel.KeyUnificationClasses` (canonical + member lists), and `TableConstraint.NullOrTrue.Column`; plus any manifest diagnostics structures that store column names (if they are persisted across passes). Add unit tests covering shortening rewrites for both Pgsql and Mssql identifier limits.",
    "steps-to-verify": [
      "Add unit tests for identifier shortening rewriting of unified-alias pointers, key-unification classes, and `NullOrTrue` constraints.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Ordering",
    "description": "Fix deterministic ordering to respect unified-alias dependencies. Acceptance: canonical ordering guarantees the alias-dependency invariant (for every `UnifiedAlias`, its canonical and presence columns—including reference-site `..._DocumentId` and synthetic `..._Present`—appear earlier in `DbTableModel.Columns`), and places key-unification support columns (canonicals + synthetic presence flags) before dependent aliases while keeping existing key/descriptor/scalar grouping stable when possible; constraint ordering includes `NullOrTrue` deterministically (stable group + secondary name sort).",
    "steps-to-verify": [
      "Add unit tests for column-order dependency invariants (canonical/presence precede aliases) and for deterministic constraint ordering including `NullOrTrue`.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Manifests",
    "description": "Emit key-unification diagnostics in manifest JSON (per `reference/design/backend-redesign/design-docs/key-unification.md`) without changing the public `DerivedRelationalModelSet` contract surface beyond the existing key-unification metadata. Acceptance: `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Build/RelationalModelManifestEmitter.cs` emits `key_unification_equality_constraints` and always includes it (empty arrays when none): `applied`/`redundant`/`ignored` plus `ignored_by_reason`; endpoint paths are canonicalized to undirected `(minPath,maxPath)` ordering while preserving duplicate ApiSchema entries; ignored.reason supports only `cross_table`; applied entries include resolved endpoint binding columns and the final `canonical_column`. Also emit per-table `descriptor_fk_deduplications` always present (empty when none) with deterministic ordering and including `constraint_name` for each de-dup group. Ensure `NullOrTrue` constraints serialize deterministically in `constraints[]`.",
    "steps-to-verify": [
      "Update `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/RelationalModelManifestEmitterTests.cs` to assert new properties exist and are empty when appropriate.",
      "Add a focused minimal-schema test that produces applied/redundant/cross_table cases and asserts the emitted report shape and ordering.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Goldens",
    "description": "Update authoritative DS 5.2 fixtures/goldens to validate end-to-end set-level behavior. Acceptance: `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/RelationalModelAuthoritativeGoldenTests.cs` switches from the per-resource pipeline to the set-level `DerivedRelationalModelSetBuilder` so reference binding + key unification + descriptor FK de-dup + diagnostics execute; `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/DerivedRelationalModelSetAuthoritativeGoldenTests.cs` includes `Ed-Fi.StudentAssessmentRegistration` and `Ed-Fi.ProgramEvaluationElement` in `resource_details` for key-unification coverage; goldens pass without `UPDATE_GOLDENS`, and no `RelationalMappingVersion` bump is introduced (fixtures may remain on existing version strings such as `1.0.0`).",
    "steps-to-verify": [
      "Regenerate goldens once: `UPDATE_GOLDENS=1 dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Verify clean diff: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`"
    ],
    "completed": true
  },
  {
    "category": "Docs",
    "description": "Update mapping-pack/proto surfaces in design docs only (no new in-repo .proto project). Acceptance: `reference/design/backend-redesign/design-docs/mpack-format-v1.md` updates `TableConstraint` to cover `AllOrNoneNullability`, `NullOrTrue`, and FK referential actions (on_delete/on_update) while keeping existing key-unification payload additions (`DbColumnModel.storage`, `DbTableModel.key_unification_classes`, write-plan precomputed + key-unification plans); docs reflect that this repo is not bumping `RelationalMappingVersion` yet.",
    "steps-to-verify": [
      "Review doc diff: `git diff -- reference/design/backend-redesign/design-docs/mpack-format-v1.md`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Key Unification",
    "description": "Remove foreign key mutation from key unification and replace it with a set-level invariant. Acceptance: delete `RewriteForeignKeyColumnsToStorage` (and helper `ResolveForeignKeyStorageColumn`) from `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs` so the pass no longer rewrites any pre-existing PK/UK/FK/all-or-none constraints (per `reference/design/backend-redesign/design-docs/key-unification.md`, step 9). Enforce the contract via `ValidateForeignKeyStorageInvariantPass` (or a new invariant pass): fail fast deterministically if any FK local or target column is a `ColumnStorage.UnifiedAlias` or a synthetic `..._Present` presence-flag column, and ensure the diagnostic includes constraint name, table, and offending column(s).",
    "steps-to-verify": [
      "Add/extend unit tests that exercise an FK referencing an alias column and assert the invariant pass fails fast with an actionable message.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Contracts",
    "description": "Make `DbColumnModel.Storage` a positional record component to match the `reference/design/backend-redesign/design-docs/key-unification.md` contract and avoid equality/deconstruction footguns. Acceptance: update `src/dms/backend/EdFi.DataManagementService.Backend.External/RelationalModelTypes.cs` so `DbColumnModel` primary constructor includes `ColumnStorage Storage`, preserving a backwards-compatible constructor that defaults `Storage` to `new ColumnStorage.Stored()` for existing call sites. Ensure `record` equality, `Deconstruct`, and `with`-expressions all include `Storage`, and update all call sites/serializers accordingly so unit tests and goldens remain green.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.Ddl.Tests.Unit/EdFi.DataManagementService.Backend.Ddl.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Key Unification",
    "description": "Remove the dead/pointless branch in `ResolveCanonicalBaseName` in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs`. Acceptance: either simplify to the spec behavior (canonical base token is deterministically the first ordered member’s base token per `reference/design/backend-redesign/design-docs/key-unification.md`) without allocating/validating unused token arrays, or implement a meaningful divergent rule with explicit unit tests; current behavior must not remain as an indistinguishable conditional.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Key Unification",
    "description": "Eliminate redundant sorting and allocations in connected-component ordering in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs`. Acceptance: remove the second per-component `OrderBy(...)` inside `string.Join(\"|\", ...)` since components are already sorted by `BuildConnectedComponents`, and replace the `string.Join` sorting key with a clearer/cheaper deterministic comparer (e.g., compare by first element then length then sequence) so ordering remains stable without unnecessary string allocations.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Refactoring",
    "description": "Consolidate FK validation logic to a single authoritative implementation. Acceptance: remove or refactor the duplicate FK-column validation currently implemented in both `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ValidateForeignKeyStorageInvariantPass.cs` and `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/DeriveIndexInventoryPass.cs` by extracting a shared validator (or by relying solely on the invariant pass with explicit pass-ordering guarantees). Ensure both local and target column validation consistently rejects `UnifiedAlias` columns and synthetic presence-flag columns, and that error messages remain deterministic and actionable.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Dialect Shortening",
    "description": "Simplify UnifiedAlias change detection in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ApplyDialectIdentifierShorteningPass.cs`. Acceptance: replace the current multi-branch `changed` computation for `ColumnStorage.UnifiedAlias` with an equivalent expression that is easier to audit, e.g. `changed = !updatedCanonicalColumn.Equals(unifiedAlias.CanonicalColumn) || !Nullable.Equals(updatedPresenceColumn, unifiedAlias.PresenceColumn)`, and ensure behavior is unchanged via unit tests/goldens.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Key Unification",
    "description": "Canonical base-name derivation should fail fast on malformed member paths and follow `reference/design/backend-redesign/design-docs/key-unification.md`. Important: if this change breaks a golden test with src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/authoritative/ds-5.2/inputs/ds-5.2-api-schema-authoritative.json or src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/Fixtures/authoritative/sample/inputs/sample-api-schema-authoritative.json then revert the change and mark this task as completed. Acceptance: in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs` `BuildMemberBaseToken` handles the \"relative segment list is empty\" case only when `relativeSegments.Length == 0` (not just when the derived property list is empty), and fails fast when the stripped relative segment list is non-empty but yields no property segments; add/extend unit tests in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/KeyUnificationPassTests.cs` covering (a) normal property-relative paths, (b) `SourceJsonPath == JsonScope` wildcard-scope cases deriving from the last prefix property segment, and (c) invalid shapes failing with actionable messages.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Refactoring",
    "description": "Remove dead code in `UnifiedAliasStorageResolver.TableMetadata`. Acceptance: delete `ReferenceSitePresenceColumns` from `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/UnifiedAliasStorageResolver.cs` (and all associated population); after the change, there are no unused metadata fields and behavior is unchanged.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Maintainability",
    "description": "Inline the `ResolveCanonicalBaseName` wrapper to reduce indirection. Acceptance: in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs`, remove `ResolveCanonicalBaseName(...)` (currently a one-liner) and call `BuildMemberBaseToken(members[0], ...)` directly (or rename/refactor so the method name matches actual behavior).",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Refactoring",
    "description": "Deduplicate unified-alias presence-gate validation across passes (index inventory, trigger inventory, descriptor FK derivation, FK invariants). Acceptance: introduce a single authoritative validation step immediately after `KeyUnificationPass` (e.g., a `ValidateUnifiedAliasMetadataPass` wired in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/Build/RelationalModelSetPasses.cs`) OR cache `UnifiedAliasStorageResolver.TableMetadata` per table in the shared context so strict validation is performed once with consistent `PresenceGateMetadataOptions`, and downstream passes reuse the result without re-validating. Ensure error messages remain deterministic and include table/column context.",
    "steps-to-verify": [
      "Add/extend unit tests that construct invalid unified-alias metadata (missing presence column, invalid strict synthetic presence flag) and assert the model build fails fast with an actionable message.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Maintainability",
    "description": "Mark throw-only helpers with `[DoesNotReturn]` to simplify control flow in key unification. Acceptance: annotate throw-only helpers (e.g., `ThrowAmbiguousEndpointBinding`) in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs` with `System.Diagnostics.CodeAnalysis.DoesNotReturn` and remove any \"unreachable but required\" returns (e.g., in `ResolveEndpointTableIndex`).",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Maintainability",
    "description": "Remove redundant `DistinctBy(column => column.ColumnName)` in `ApplyKeyUnificationToTable`. Acceptance: in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs`, remove the `DistinctBy` call and keep deterministic member ordering unchanged; add a small regression test (or internal assertion) that connected-component derivation never produces duplicate member column names.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Performance",
    "description": "Cache per-table `UnifiedAliasStorageResolver.TableMetadata` in `ReferenceConstraintPass.MapReferenceIdentityColumnsToStorage` to avoid rebuilding metadata for every reference mapping. Acceptance: `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ReferenceConstraintPass.cs` reuses metadata by `DbTableName` within the pass execution so schemas with many references do not repeatedly allocate dictionaries/sets, and all derived constraints/diagnostics remain identical.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Key Unification",
    "description": "Fix root-table replacement in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs` to key by `DbTableModel.JsonScope` (not just `DbTableName`) when selecting `updatedRoot` after per-table rewrites. Acceptance: the root replacement uses `tables.Single(table => table.JsonScope.Equals(updatedModel.Root.JsonScope))` (or equivalent), matching patterns in other passes (e.g., `DescriptorForeignKeyConstraintPass`), and a regression unit test demonstrates correct root selection when multiple `DbTableModel` entries share the same `DbTableName` but differ by `JsonScope`.",
    "steps-to-verify": [
      "Add/extend a unit test in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/KeyUnificationPassTests.cs` that constructs a resource model where two tables share a `DbTableName` but have different `JsonScope`, then asserts `RelationalResourceModel.Root.JsonScope` is preserved and the root table instance is the one updated by key-unification.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Key Unification",
    "description": "De-duplicate identical `resourceSchema.equalityConstraints` when merging base + extension constraints in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs` (`Execute`). Acceptance: the combined constraint list for a concrete resource is de-duped by an undirected canonical `(minPath,maxPath)` key (so `A==B` and `B==A` collapse) before graph-edge construction and diagnostics, preventing redundant edges and duplicate redundant/applied diagnostics when the same constraint appears in both base and extension schemas.",
    "steps-to-verify": [
      "Add/extend a unit test in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/KeyUnificationPassTests.cs` with a base resource + extension both defining the same equality constraint (including a reversed-endpoint variant) and assert only one constraint instance is processed (no duplicated diagnostics and no redundant edges).",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Key Unification",
    "description": "Harden `ValidateUnificationMembers` in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs` for descriptor endpoints. Acceptance: for `ColumnKind.DescriptorFk` unification classes, validation fails fast when any member has `TargetResource is null` (and continues to require exact `TargetResource` equality across members), producing an actionable error message that includes resource + table + column context.",
    "steps-to-verify": [
      "Add/extend a unit test in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/KeyUnificationPassTests.cs` that forces a `DescriptorFk` column with `TargetResource=null` into a unification class and asserts the pass throws with a message that identifies the offending column.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Maintainability",
    "description": "Remove redundant `ValidateConnectedComponentHasUniqueMembers` from `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/KeyUnificationPass.cs`. Acceptance: delete the helper and its call site(s) since `BuildConnectedComponents` groups over distinct dictionary keys (duplicates cannot occur), and ensure connected-component derivation and deterministic ordering remain unchanged (tests remain green).",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": false
  },
  {
    "category": "Reference Constraints",
    "description": "Use strict unified-alias metadata in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ReferenceConstraintPass.cs` instead of building a pass-local non-strict metadata cache. Acceptance: remove `GetOrCreateTableMetadata(...)` and `tableMetadataCache` (or make them strict), and replace all metadata acquisition with `UnifiedAliasStrictMetadataCache.GetOrBuild(context, table)` so missing presence columns / invalid synthetic presence flags fail fast instead of silently continuing.",
    "steps-to-verify": [
      "Add/extend a unit test (e.g., in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/ConstraintDerivationRelationalModelSetPassTests.cs`) that introduces an invalid unified-alias presence gate (missing presence column or invalid synthetic presence flag) and assert `ReferenceConstraintPass` fails fast with an actionable message.",
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  },
  {
    "category": "Refactoring",
    "description": "Centralize duplicated `BuildReferenceMappingContext(...)` helpers used for invariant error prefixes across passes. Acceptance: replace the private helpers in `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/ReferenceConstraintPass.cs` and `src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel/SetPasses/DeriveTriggerInventoryPass.cs` with a single shared helper (in an appropriate shared location) and ensure the formatted strings remain identical so existing tests and diagnostics do not change.",
    "steps-to-verify": [
      "Run: `dotnet test --no-restore ./src/dms/backend/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit/EdFi.DataManagementService.Backend.RelationalModel.Tests.Unit.csproj`",
      "Run: `dotnet build --no-restore ./src/dms/EdFi.DataManagementService.sln`"
    ],
    "completed": true
  }
]
