-- MSSQL CREATE TABLE edfi_DomainEntityName
IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'edfi_DomainEntityName' AND SCHEMA_NAME(schema_id) = 'dms')
BEGIN
    CREATE TABLE [dms].[edfi_DomainEntityName] (
    [Id] BIGINT PRIMARY KEY IDENTITY(1,1),
    [Document_Id] BIGINT NOT NULL,
    [Document_PartitionKey] TINYINT NOT NULL,
    [StringIdentity] NVARCHAR(30) NOT NULL,
    [CreateDate] DATETIME2 NOT NULL,
    [LastModifiedDate] DATETIME2 NOT NULL,
    [ChangeVersion] BIGINT NOT NULL
,
    CONSTRAINT [UQ_DomainEntityName_NaturalKey]
        UNIQUE ([StringIdentity])
    );
    PRINT 'Table edfi_DomainEntityName created.';
END
ELSE
    PRINT 'Table edfi_DomainEntityName already exists, skipped.';

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE name = 'IX_DomainEntityName_Document' AND object_id = OBJECT_ID('[dms].[edfi_DomainEntityName]'))
BEGIN
    CREATE NONCLUSTERED INDEX [IX_DomainEntityName_Document]
        ON [dms].[edfi_DomainEntityName]([Document_Id], [Document_PartitionKey]);
    PRINT 'Index IX_DomainEntityName_Document created.';
END

-- MSSQL CREATE TABLE edfi_DomainEntityNameRequiredIntegerProperty
IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'edfi_DomainEntityNameRequiredIntegerProperty' AND SCHEMA_NAME(schema_id) = 'dms')
BEGIN
    CREATE TABLE [dms].[edfi_DomainEntityNameRequiredIntegerProperty] (
    [Id] BIGINT PRIMARY KEY IDENTITY(1,1),
    [Document_Id] BIGINT NOT NULL,
    [Document_PartitionKey] TINYINT NOT NULL,
    [DomainEntityName_Id] BIGINT NOT NULL,
    [RequiredIntegerProperty] INT,
    [CreateDate] DATETIME2 NOT NULL,
    [LastModifiedDate] DATETIME2 NOT NULL,
    [ChangeVersion] BIGINT NOT NULL
    );
    PRINT 'Table edfi_DomainEntityNameRequiredIntegerProperty created.';
END
ELSE
    PRINT 'Table edfi_DomainEntityNameRequiredIntegerProperty already exists, skipped.';

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE name = 'IX_DomainEntityNameRequiredIntegerProperty_DomainEntityName' AND object_id = OBJECT_ID('[dms].[edfi_DomainEntityNameRequiredIntegerProperty]'))
BEGIN
    CREATE NONCLUSTERED INDEX [IX_DomainEntityNameRequiredIntegerProperty_DomainEntityName]
        ON [dms].[edfi_DomainEntityNameRequiredIntegerProperty]([DomainEntityName_Id]);
    PRINT 'Index IX_DomainEntityNameRequiredIntegerProperty_DomainEntityName created.';
END
IF NOT EXISTS (SELECT * FROM sys.indexes WHERE name = 'IX_DomainEntityNameRequiredIntegerProperty_Document' AND object_id = OBJECT_ID('[dms].[edfi_DomainEntityNameRequiredIntegerProperty]'))
BEGIN
    CREATE NONCLUSTERED INDEX [IX_DomainEntityNameRequiredIntegerProperty_Document]
        ON [dms].[edfi_DomainEntityNameRequiredIntegerProperty]([Document_Id], [Document_PartitionKey]);
    PRINT 'Index IX_DomainEntityNameRequiredIntegerProperty_Document created.';
END

-- MSSQL CREATE TABLE edfi_DomainEntityNameSchoolYear
IF NOT EXISTS (SELECT * FROM sys.tables WHERE name = 'edfi_DomainEntityNameSchoolYear' AND SCHEMA_NAME(schema_id) = 'dms')
BEGIN
    CREATE TABLE [dms].[edfi_DomainEntityNameSchoolYear] (
    [Id] BIGINT PRIMARY KEY IDENTITY(1,1),
    [Document_Id] BIGINT NOT NULL,
    [Document_PartitionKey] TINYINT NOT NULL,
    [DomainEntityName_Id] BIGINT NOT NULL,
    [SchoolYear] INT,
    [CreateDate] DATETIME2 NOT NULL,
    [LastModifiedDate] DATETIME2 NOT NULL,
    [ChangeVersion] BIGINT NOT NULL
    );
    PRINT 'Table edfi_DomainEntityNameSchoolYear created.';
END
ELSE
    PRINT 'Table edfi_DomainEntityNameSchoolYear already exists, skipped.';

IF NOT EXISTS (SELECT * FROM sys.indexes WHERE name = 'IX_DomainEntityNameSchoolYear_DomainEntityName' AND object_id = OBJECT_ID('[dms].[edfi_DomainEntityNameSchoolYear]'))
BEGIN
    CREATE NONCLUSTERED INDEX [IX_DomainEntityNameSchoolYear_DomainEntityName]
        ON [dms].[edfi_DomainEntityNameSchoolYear]([DomainEntityName_Id]);
    PRINT 'Index IX_DomainEntityNameSchoolYear_DomainEntityName created.';
END
IF NOT EXISTS (SELECT * FROM sys.indexes WHERE name = 'IX_DomainEntityNameSchoolYear_Document' AND object_id = OBJECT_ID('[dms].[edfi_DomainEntityNameSchoolYear]'))
BEGIN
    CREATE NONCLUSTERED INDEX [IX_DomainEntityNameSchoolYear_Document]
        ON [dms].[edfi_DomainEntityNameSchoolYear]([Document_Id], [Document_PartitionKey]);
    PRINT 'Index IX_DomainEntityNameSchoolYear_Document created.';
END


-- Foreign Key Constraints

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE name = 'FK_DomainEntityName_Document')
BEGIN
    ALTER TABLE [dms].[edfi_DomainEntityName] ADD CONSTRAINT [FK_DomainEntityName_Document] FOREIGN KEY ([Document_Id], [Document_PartitionKey]) REFERENCES [dms].[Document]([Id], [DocumentPartitionKey]) ON DELETE CASCADE;
    PRINT 'Foreign key constraint FK_DomainEntityName_Document created.';
END
ELSE
    PRINT 'Foreign key constraint FK_DomainEntityName_Document already exists, skipped.';
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE name = 'FK_DomainEntityNameRequiredIntegerProperty_DomainEntityName')
BEGIN
    ALTER TABLE [dms].[edfi_DomainEntityNameRequiredIntegerProperty] ADD CONSTRAINT [FK_DomainEntityNameRequiredIntegerProperty_DomainEntityName] FOREIGN KEY ([DomainEntityName_Id]) REFERENCES [dms].[edfi_DomainEntityName]([Id]) ON DELETE CASCADE;
    PRINT 'Foreign key constraint FK_DomainEntityNameRequiredIntegerProperty_DomainEntityName created.';
END
ELSE
    PRINT 'Foreign key constraint FK_DomainEntityNameRequiredIntegerProperty_DomainEntityName already exists, skipped.';
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE name = 'FK_DomainEntityNameRequiredIntegerProperty_Document')
BEGIN
    ALTER TABLE [dms].[edfi_DomainEntityNameRequiredIntegerProperty] ADD CONSTRAINT [FK_DomainEntityNameRequiredIntegerProperty_Document] FOREIGN KEY ([Document_Id], [Document_PartitionKey]) REFERENCES [dms].[Document]([Id], [DocumentPartitionKey]) ON DELETE CASCADE;
    PRINT 'Foreign key constraint FK_DomainEntityNameRequiredIntegerProperty_Document created.';
END
ELSE
    PRINT 'Foreign key constraint FK_DomainEntityNameRequiredIntegerProperty_Document already exists, skipped.';
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE name = 'FK_DomainEntityNameSchoolYear_DomainEntityName')
BEGIN
    ALTER TABLE [dms].[edfi_DomainEntityNameSchoolYear] ADD CONSTRAINT [FK_DomainEntityNameSchoolYear_DomainEntityName] FOREIGN KEY ([DomainEntityName_Id]) REFERENCES [dms].[edfi_DomainEntityName]([Id]) ON DELETE CASCADE;
    PRINT 'Foreign key constraint FK_DomainEntityNameSchoolYear_DomainEntityName created.';
END
ELSE
    PRINT 'Foreign key constraint FK_DomainEntityNameSchoolYear_DomainEntityName already exists, skipped.';
GO

IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE name = 'FK_DomainEntityNameSchoolYear_Document')
BEGIN
    ALTER TABLE [dms].[edfi_DomainEntityNameSchoolYear] ADD CONSTRAINT [FK_DomainEntityNameSchoolYear_Document] FOREIGN KEY ([Document_Id], [Document_PartitionKey]) REFERENCES [dms].[Document]([Id], [DocumentPartitionKey]) ON DELETE CASCADE;
    PRINT 'Foreign key constraint FK_DomainEntityNameSchoolYear_Document created.';
END
ELSE
    PRINT 'Foreign key constraint FK_DomainEntityNameSchoolYear_Document already exists, skipped.';
GO

