CREATE SCHEMA IF NOT EXISTS dms;


CREATE TABLE IF NOT EXISTS dms.edfi_Assessment (
    Id BIGSERIAL PRIMARY KEY,
    Document_Id BIGINT NOT NULL,
    Document_PartitionKey SMALLINT NOT NULL,
    AssessmentIdentifier INTEGER NOT NULL,
    AssessedGradeLevelDescriptorId BIGINT,
    CreateDate TIMESTAMP NOT NULL,
    LastModifiedDate TIMESTAMP NOT NULL,
    ChangeVersion BIGINT NOT NULL
,
    CONSTRAINT UQ_Assessment_NaturalKey
        UNIQUE (AssessmentIdentifier)
);

CREATE INDEX IF NOT EXISTS IX_Assessment_Document
    ON dms.edfi_Assessment(Document_Id, Document_PartitionKey);


-- Foreign Key Constraints

ALTER TABLE dms.edfi_Assessment
    ADD CONSTRAINT FK_Assessment_Document
    FOREIGN KEY (Document_Id, Document_PartitionKey)
    REFERENCES dms.Document(Id, DocumentPartitionKey) ON DELETE CASCADE;

