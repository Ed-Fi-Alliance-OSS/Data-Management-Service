Feature: Invalid Reference Validation
    PUT requests validation for invalid references

        Background:
            Given the system has these School Years
                  | schoolYear | currentSchoolYear | schoolYearDescription |
                  | 2022       | false             | 2021-2022             |
              And the system has these Calendars
                  | calendarCode | schoolId  | schoolYear | calendarTypeDescriptor |
                  | 2010605675   | 255901107 | 2022       | ["Student Specific"]   |
              And the system has these Schools
                  | educationOrganizationCategoryDescriptor | gradeLevels     | schoolId  | nameOfInstitution            |
                  | ["School"]                              | ["First grade"] | 255901107 | Grand Bend Elementary School |
              And the system has these Education Organization Category Descriptors
                  | codeValue | namespace                                               | shortDescription |
                  | School    | uri://ed-fi.org/EducationOrganizationCategoryDescriptor | School           |
              And the system has these Students
                  | studentUniqueId | birthDate  | firstName | lastSurname |
                  | 604824          | 2010-01-13 | Traci     | Mathews     |
              And the system has these Local Education Agencies
                  | educationOrganizationCategoryDescriptor | localEducationAgencyId | localEducationAgencyCategoryDescriptor | nameOfInstitution |
                  | ["School"]                              | 255901                 | ["Independent"]                        | Grand Bend ISD    |
              And the system has these Student Education Organization Associations
                  | educationOrganizationId | studentUniqueId |
                  | 255901                  | 604834          |
              And the system has these Student CTE Program Associations
                  | beginDate  | educationOrganizationId | educationOrganizationId | programName                    | programTypeDescriptor              | studentUniqueId |
                  | 2020-06-05 | 255901                  | 255901                  | Career and Technical Education | ["Career and Technical Education"] | 604825          |
              And the system has these Graduation Plans
                  | graduationPlanTypeDescriptor   | educationOrganizationId | schoolYear | totalRequiredCredits |
                  | Career and Technical Education | 255901                  | 2022       | 10.000               |
              And the system has these Student Section Associations
                  | beginDate  | localCourseCode | schoolId  | schoolYear | sectionIdentifier           | sessionName             | studentUniqueId |
                  | 2021-08-23 | ALG-1           | 255901001 | 2022       | 25590100102Trad220ALG112011 | 2021-2022 Fall Semester | 604874          |

        @ignore
        Scenario: 01 Ensure clients cannot update a resource with a Descriptor that does not exist
            Given Local Education Agency ID 255901
             When a PUT request is made to "ed-fi/localEducationAgencies/{id}" with
                  """
                  {
                      "localEducationAgencyId": 255901,
                      "nameOfInstitution": "Grand Bend ISD ",
                      "localEducationAgencyCategoryDescriptor": "uri://ed-fi.org/LocalEducationAgencyCategoryDescriptor#Independent",
                      "categories": [
                          {
                              "educationOrganizationCategoryDescriptor": "uri://ed-fi.org/EducationOrganizationCategoryDescriptor#Fake"
                          }
                      ]
                  }
                  """
             Then it should respond with 409
              And the response body is
                  """
                  {
                      "detail": "The referenced 'Categories' item does not exist.",
                      "type": "urn:ed-fi:api:data-conflict:unresolved-reference",
                      "title": "Unresolved Reference",
                      "status": 409,
                      "correlationId": null
                  }
                  """

        @ignore
        Scenario: 02 Ensure clients cannot update a resource missing a direct reference
            Given Education Organization Reference 255901
             When a PUT request is made to "ed-fi/studentEducationOrganizationAssociations/{id}" with
                  """
                  {
                      "educationOrganizationReference": {
                          "educationOrganizationId": 255901
                      }
                  }
                  """
             Then it should respond with 409
              And the response body is
                  """
                  {
                      "detail": "The referenced 'StudentReference' item does not exist.",
                      "type": "urn:ed-fi:api:data-conflict:unresolved-reference",
                      "title": "Unresolved Reference",
                      "status": 409,
                      "correlationId": null
                  }
                  """

        @ignore
        Scenario: 03 Ensure clients cannot update a resource using a correct reference but missing the other one
            Given Student Unique ID 604834
             When a PUT request is made to "ed-fi/studentEducationOrganizationAssociations/{id}" with
                  """
                  {
                      "studentReference": {
                        "studentUniqueId":"604834"
                      }
                  }
                  """
             Then it should respond with 409
              And the response body is
                  """
                  {
                      "detail": "The referenced 'EducationOrganizationReference' item does not exist.",
                      "type": "urn:ed-fi:api:data-conflict:unresolved-reference",
                      "title": "Unresolved Reference",
                      "status": 409,
                      "correlationId": null
                  }
                  """

        @ignore
        Scenario: 04 Ensure clients cannot update a resource that uses a reference more than once
            Given Studen Unique ID 604825
             When a PUT request is made to "ed-fi/studentCTEProgramAssociations/9aa43c870d244c939d366fbfd5ecab10" with
                  """
                  {
                      "beginDate": "2020-06-05",
                      "programReference": {
                        "programName": "Career and Technical Education",
                        "programTypeDescriptor": "uri://ed-fi.org/ProgramTypeDescriptor#Career and Technical Education"
                      },
                      "studentReference": {
                          "studentUniqueId": "604825"
                      }
                  }
                  """
             Then it should respond with 409
              And the response body is
                  """
                  {
                      "detail": "The referenced 'EducationOrganizationReference' item does not exist.",
                      "type": "urn:ed-fi:api:data-conflict:unresolved-reference",
                      "title": "Unresolved Reference",
                      "status": 409,
                      "correlationId": null
                  }
                  """

        @ignore
        Scenario: 05 Ensure clients cannot update a resource that uses a reference more than once and misses another required reference
            Given Program Name Career and Technical Education
             When a PUT request is made to "ed-fi/studentCTEProgramAssociations/{id}" with
                  """
                  {
                      "beginDate": "2020-06-05",
                      "educationOrganizationReference": {
                          "educationOrganizationId": 255901
                      },
                      "programReference": {
                        "programName": "Career and Technical Education",
                        "programTypeDescriptor": "uri://ed-fi.org/ProgramTypeDescriptor#Career and Technical Education"
                      }
                  }
                  """
             Then it should respond with 409
              And the response body is
                  """
                  {
                      "detail": "The referenced 'StudentReference' item does not exist.",
                      "type": "urn:ed-fi:api:data-conflict:unresolved-reference",
                      "title": "Unresolved Reference",
                      "status": 409,
                      "correlationId": null
                  }
                  """

        @ignore
        Scenario: 06 Ensure clients cannot update a resource that uses an invalid date from a reference
            Given Education Organization ID 255901
             When a PUT request is made to "ed-fi/graduationPlans/{id}" with
                  """
                  {
                      "educationOrganizationReference": {
                          "educationOrganizationId": 255901
                      },
                      "graduationSchoolYearTypeReference": {
                          "schoolYear": 1970
                      },
                      "graduationPlanTypeDescriptor": "uri://ed-fi.org/GraduationPlanTypeDescriptor#Career and Technical Education",
                      "totalRequiredCredits": 10.000
                  }
                  """
             Then it should respond with 409
              And the response body is
                  """
                  {
                      "detail": "The referenced 'GraduationSchoolYearTypeReference' item does not exist.",
                      "type": "urn:ed-fi:api:data-conflict:unresolved-reference",
                      "title": "Unresolved Reference",
                      "status": 409,
                      "correlationId": null
                  }
                  """

        @ignore
        Scenario: 07 Ensure clients cannot update a resource that is incorrect from a deep reference
            Given Student Unique ID 604874
             When a PUT request is made to "ed-fi/studentSectionAssociations/{id}" with
                  """
                  {
                      "sectionReference": {
                          "localCourseCode": "ALG-1",
                          "schoolYear": 2022,
                          "sectionIdentifier": "25590100102Trad220ALG112011",
                          "sessionName": "2021-2022 Fall Semester"
                      },
                      "studentReference": {
                          "studentUniqueId": "604874"
                      },
                      "beginDate": "2021-08-23"
                  }
                  """
             Then it should respond with 409
              And the response body is
                  """
                  {
                      "detail": "The referenced 'SectionReferenceSectionReference' item does not exist.",
                      "type": "urn:ed-fi:api:data-conflict:unresolved-reference",
                      "title": "Unresolved Reference",
                      "status": 409,
                      "correlationId": null
                  }
                  """
