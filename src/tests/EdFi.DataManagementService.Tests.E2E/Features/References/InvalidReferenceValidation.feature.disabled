Feature: Invalid Reference Validation
    POST requests validating invalid references

        Background
            Given the system has these Schools
                  | schoolId  | nameOfInstitution      | educationOrganizationCategoryDescriptor | gradeLevelDescriptor |
                  | 255901001 | Grand Bend High School | ["School"]                              | ["Eleventh grade"]   |
              And the system has these Courses
                  | courseCode | courseIdentificationSystemDescriptor | identificationCode | educationOrganizationId | courseTitle |
                  | ALG-1      | ["LEA course code"]                  | ALG-1              | 255901001               | Algebra I   |

        @ignore
        Scenario: 01 Ensure clients cannot create a resource with a non existing reference
             When a POST request is made to "ed-fi/academicWeeks" with
                  """
                  {
                   "weekIdentifier": "one",
                   "schoolReference": {
                     "schoolId": 9999
                   },
                   "beginDate": "2023-09-11",
                   "endDate": "2023-09-11",
                   "totalInstructionalDays": 300
                  }
                  """
             Then it should respond with 409
              And the response body is
                  """
                  {
                      "detail": "The referenced 'schoolId' resource does not exist.",
                      "type": "urn:ed-fi:api:conflict:invalid-reference",
                      "title": "Resource Not Unique Conflict due to invalid-reference",
                      "status": 409,
                      "correlationId": null
                  }
                  """

        @ignore
        Scenario: 02 Ensure clients cannot create a resource with correct information but an invalid value belonging to the reference
             When a POST request is made to "ed-fi/studentCTEProgramAssociations" with
                  """
                  {
                      "beginDate": "2020-06-05",
                      "educationOrganizationReference": {
                          "educationOrganizationId": 255901
                      },
                      "programReference": {
                          "educationOrganizationId": 255901,
                          "programName": "Fake",
                          "programTypeDescriptor": "uri://ed-fi.org/ProgramTypeDescriptor#Career and Technical Education"
                      },
                      "studentReference": {
                          "studentUniqueId": "604825"
                      }
                  }
                  """
             Then it should respond with 409
              And the response body is
                  """
                  {
                      "detail": "The referenced 'Program' resource does not exist.",
                      "type": "urn:ed-fi:api:conflict:invalid-reference",
                      "title": "Resource Not Unique Conflict due to invalid-reference",
                      "status": 409,
                      "correlationId": null
                  }
                  """

        @ignore
        Scenario: 03 Ensure clients cannot create a resource using a reference that is out of range of the existing values
             When a POST request is made to "ed-fi/graduationPlans" with
                  """
                  {
                     "graduationPlanTypeDescriptor": "uri://ed-fi.org/GraduationPlanTypeDescriptor#Career and Technical Education",
                     "educationOrganizationReference": {
                         "educationOrganizationId": 255901
                     },
                     "graduationSchoolYearTypeReference": {
                         "schoolYear": 1970
                     },
                     "totalRequiredCredits": 10
                  }
                  """
             Then it should respond with 409
              And the response body is
                  """
                  {
                    "detail": "The referenced 'SchoolYearType' resource does not exist.",
                    "type": "urn:ed-fi:api:conflict:invalid-reference",
                    "title": "Resource Not Unique Conflict due to invalid-reference",
                    "status": 409,
                    "correlationId": null
                  }
                  """

        @ignore
        Scenario: 04 Ensure clients cannot create a resource using an invalid reference inside of another reference
             When a POST request is made to "ed-fi/studentSectionAssociations" with
                  """
                  {
                      "beginDate": "2023-08-23",
                      "sectionReference": {
                          "localCourseCode": "ALG-1",
                          "schoolId": 255901,
                          "schoolYear": 2022,
                          "sectionIdentifier": "25590100103Trad220ALG122011",
                          "sessionName": "2021-2022 Spring Semester"
                      },
                      "studentReference": {
                          "studentUniqueId": "604824"
                      }
                  }
                  """
             Then it should respond with 409
              And the response body is
                  """
                  {
                      "detail": "The referenced 'Section' resource does not exist.",
                      "type": "urn:ed-fi:api:conflict:invalid-reference",
                      "title": "Resource Not Unique Conflict due to invalid-reference",
                      "status": 409,
                      "correlationId": null
                  }
                  """

        @ignore
        Scenario: 05 Verify clients cannot update a resource that is missing a reference
        # CourseOffering should also have `sessionReference`, which has been omitted in the JSON below
            Given Local Course Code "ALG-1 TEST-101"
            #set value to {id}
             When a PUT request is made to "ed-fi/courseOfferings/{id}"
                  """
                  {
                      "localCourseCode": "ALG-1 TEST-101",
                      "courseReference": {
                          "courseCode": "ALG-1",
                          "educationOrganizationId": 255901001
                      },
                      "schoolReference": {
                          "schoolId": 255901001
                      }
                  }
                  """
             Then it should respond with 400
              And the response body is
                  """
                  {
                      "detail": "Data validation failed. See 'validationErrors' for details.",
                      "type": "urn:ed-fi:api:bad-request:data-validation-failed",
                      "title": "Data Validation Failed",
                      "status": 400,
                      "correlationId": null,
                      "validationErrors": {
                          "$.sessionReference": [
                              "SessionReference is required."
                          ]
                      }
                  }
                  """
